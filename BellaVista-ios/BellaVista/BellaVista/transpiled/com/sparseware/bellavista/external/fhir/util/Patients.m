//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: com/sparseware/bellavista/external/fhir/util/Patients.java
//
//  Created by decoteaud on 11/18/15.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/appnativa/rare/Platform.h"
#include "com/appnativa/rare/net/ActionLink.h"
#include "com/appnativa/util/CharArray.h"
#include "com/appnativa/util/Helper.h"
#include "com/appnativa/util/ObjectHolder.h"
#include "com/appnativa/util/json/JSONArray.h"
#include "com/appnativa/util/json/JSONObject.h"
#include "com/appnativa/util/json/JSONTokener.h"
#include "com/appnativa/util/json/JSONWriter.h"
#include "com/sparseware/bellavista/ActionPath.h"
#include "com/sparseware/bellavista/MessageException.h"
#include "com/sparseware/bellavista/Utils.h"
#include "com/sparseware/bellavista/external/fhir/FHIRJSONWatcher.h"
#include "com/sparseware/bellavista/external/fhir/FHIRServer.h"
#include "com/sparseware/bellavista/external/fhir/FHIRUtils.h"
#include "com/sparseware/bellavista/external/fhir/Patient.h"
#include "com/sparseware/bellavista/external/fhir/aFHIRemoteService.h"
#include "com/sparseware/bellavista/external/fhir/util/Patients.h"
#include "com/sparseware/bellavista/external/fhir/util/Users.h"
#include "com/sparseware/bellavista/service/ContentWriter.h"
#include "com/sparseware/bellavista/service/HttpHeaders.h"
#include "com/sparseware/bellavista/service/aRemoteService.h"
#include "com/sparseware/bellavista/service/iHttpConnection.h"
#include "java/io/IOException.h"
#include "java/io/InputStream.h"
#include "java/io/Reader.h"
#include "java/io/StringWriter.h"
#include "java/io/Writer.h"
#include "java/lang/Boolean.h"
#include "java/lang/Character.h"
#include "java/lang/Exception.h"
#include "java/net/URL.h"
#include "java/text/SimpleDateFormat.h"
#include "java/util/ArrayList.h"
#include "java/util/Calendar.h"
#include "java/util/Date.h"
#include "java/util/HashMap.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/regex/Matcher.h"
#include "java/util/regex/Pattern.h"

@implementation ComSparsewareBellavistaExternalFhirUtilPatients

static BOOL ComSparsewareBellavistaExternalFhirUtilPatients_myPatientsSupported_;
static BOOL ComSparsewareBellavistaExternalFhirUtilPatients_nameComponentsSearchSupported_;
static BOOL ComSparsewareBellavistaExternalFhirUtilPatients_identifierSearchSupported_;
static BOOL ComSparsewareBellavistaExternalFhirUtilPatients_idSearchSupported_;
static BOOL ComSparsewareBellavistaExternalFhirUtilPatients_dobSearchSupported_;
static BOOL ComSparsewareBellavistaExternalFhirUtilPatients_genderSearchSupported_;
static JavaUtilArrayList * ComSparsewareBellavistaExternalFhirUtilPatients_mostRecent_;
static JavaUtilHashMap * ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_;
static JavaUtilArrayList * ComSparsewareBellavistaExternalFhirUtilPatients_most_recent__;

+ (BOOL)myPatientsSupported {
  return ComSparsewareBellavistaExternalFhirUtilPatients_myPatientsSupported_;
}

+ (BOOL *)myPatientsSupportedRef {
  return &ComSparsewareBellavistaExternalFhirUtilPatients_myPatientsSupported_;
}

+ (BOOL)nameComponentsSearchSupported {
  return ComSparsewareBellavistaExternalFhirUtilPatients_nameComponentsSearchSupported_;
}

+ (BOOL *)nameComponentsSearchSupportedRef {
  return &ComSparsewareBellavistaExternalFhirUtilPatients_nameComponentsSearchSupported_;
}

+ (BOOL)identifierSearchSupported {
  return ComSparsewareBellavistaExternalFhirUtilPatients_identifierSearchSupported_;
}

+ (BOOL *)identifierSearchSupportedRef {
  return &ComSparsewareBellavistaExternalFhirUtilPatients_identifierSearchSupported_;
}

+ (BOOL)idSearchSupported {
  return ComSparsewareBellavistaExternalFhirUtilPatients_idSearchSupported_;
}

+ (BOOL *)idSearchSupportedRef {
  return &ComSparsewareBellavistaExternalFhirUtilPatients_idSearchSupported_;
}

+ (BOOL)dobSearchSupported {
  return ComSparsewareBellavistaExternalFhirUtilPatients_dobSearchSupported_;
}

+ (BOOL *)dobSearchSupportedRef {
  return &ComSparsewareBellavistaExternalFhirUtilPatients_dobSearchSupported_;
}

+ (BOOL)genderSearchSupported {
  return ComSparsewareBellavistaExternalFhirUtilPatients_genderSearchSupported_;
}

+ (BOOL *)genderSearchSupportedRef {
  return &ComSparsewareBellavistaExternalFhirUtilPatients_genderSearchSupported_;
}

+ (JavaUtilArrayList *)mostRecent {
  return ComSparsewareBellavistaExternalFhirUtilPatients_mostRecent_;
}

+ (void)setMostRecent:(JavaUtilArrayList *)mostRecent {
  ComSparsewareBellavistaExternalFhirUtilPatients_mostRecent_ = mostRecent;
}

+ (JavaUtilHashMap *)identifierMap {
  return ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_;
}

+ (void)setIdentifierMap:(JavaUtilHashMap *)identifierMap {
  ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ = identifierMap;
}

+ (JavaUtilArrayList *)most_recent {
  return ComSparsewareBellavistaExternalFhirUtilPatients_most_recent__;
}

+ (void)setMost_recent:(JavaUtilArrayList *)most_recent_ {
  ComSparsewareBellavistaExternalFhirUtilPatients_most_recent__ = most_recent_;
}

- (id)init {
  if (self = [super initWithNSString:@"Patient"]) {
    ssnPattern_ = [JavaUtilRegexPattern compileWithNSString:@"###-##-####"];
    birthDate_ = [[JavaTextSimpleDateFormat alloc] initWithNSString:@"YYYY-MM-DD"];
    columnNames_ = [IOSObjectArray arrayWithObjects:(id[]){ @"id", @"name", @"dob", @"gender", @"mrn", @"provider", @"encounter_date", @"encounter_reason", @"location", @"rm_bed", @"photo", @"attending", @"language", @"relationship", @"code_status", @"code_status_short", @"wt", @"ht", @"io_in", @"io_out" } count:20 type:[IOSClass classWithClass:[NSString class]]];
  }
  return self;
}

+ (void)initializeSupportedOptionsWithComSparsewareBellavistaExternalFhirFHIRServer_FHIRResource:(ComSparsewareBellavistaExternalFhirFHIRServer_FHIRResource *)r
                                                                            withRAREUTJSONObject:(RAREUTJSONObject *)config {
  RAREUTJSONArray *a = ((ComSparsewareBellavistaExternalFhirFHIRServer_FHIRResource *) nil_chk(r))->searchParams_;
  if (a != nil) {
    int n = 0;
    for (id __strong o in a) {
      RAREUTJSONObject *jo = (RAREUTJSONObject *) check_class_cast(o, [RAREUTJSONObject class]);
      NSString *name = [((RAREUTJSONObject *) nil_chk(jo)) optStringWithNSString:@"name"];
      if ([((NSString *) nil_chk(name)) isEqual:@"careprovider"]) {
        ComSparsewareBellavistaExternalFhirUtilPatients_myPatientsSupported_ = YES;
      }
      else if ([name equalsIgnoreCase:@"given"]) {
        n++;
      }
      else if ([name equalsIgnoreCase:@"family"]) {
        n++;
      }
      else if ([name equalsIgnoreCase:@"gender"]) {
        ComSparsewareBellavistaExternalFhirUtilPatients_genderSearchSupported_ = YES;
      }
      else if ([name equalsIgnoreCase:@"identifier"]) {
        ComSparsewareBellavistaExternalFhirUtilPatients_identifierSearchSupported_ = YES;
      }
      else if ([name equalsIgnoreCase:@"birthdate"]) {
        ComSparsewareBellavistaExternalFhirUtilPatients_dobSearchSupported_ = YES;
      }
      else if ([name equalsIgnoreCase:@"_id"]) {
        ComSparsewareBellavistaExternalFhirUtilPatients_idSearchSupported_ = YES;
      }
    }
    if (n > 1) {
      ComSparsewareBellavistaExternalFhirUtilPatients_nameComponentsSearchSupported_ = YES;
    }
  }
  (void) [((RAREUTJSONObject *) nil_chk(config)) putWithNSString:@"hasPatientAlerts" withBoolean:NO];
  (void) [config putWithNSString:@"genderSearchSupported" withBoolean:ComSparsewareBellavistaExternalFhirUtilPatients_genderSearchSupported_];
}

- (void)by_categoryWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                        withCCPBVActionPath:(CCPBVActionPath *)path
                      withJavaIoInputStream:(JavaIoInputStream *)data
                       withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
}

- (void)listWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                 withCCPBVActionPath:(CCPBVActionPath *)path
               withJavaIoInputStream:(JavaIoInputStream *)data
                withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
  id<JavaUtilMap> map = [self getQueryParamsWithJavaNetURL:[((id<CCPBViHttpConnection>) nil_chk(conn)) getURL] withJavaIoInputStream:data];
  if (map == nil) {
    [self most_recentWithCCPBViHttpConnection:conn withCCPBVActionPath:path withJavaIoInputStream:data withCCPBVHttpHeaders:headers];
    return;
  }
  RAREActionLink *l;
  NSString *href = (NSString *) check_class_cast([((id<JavaUtilMap>) nil_chk(map)) removeWithId:@"href"], [NSString class]);
  NSString *count = (NSString *) check_class_cast([map getWithId:@"max"], [NSString class]);
  if (href == nil) {
    NSString *gender = (NSString *) check_class_cast([map getWithId:@"gender"], [NSString class]);
    NSString *id_ = (NSString *) check_class_cast([map getWithId:@"identifier"], [NSString class]);
    NSString *s;
    [map clear];
    int n;
    if ([((NSString *) nil_chk(id_)) hasPrefix:@"`"]) {
      if (ComSparsewareBellavistaExternalFhirUtilPatients_idSearchSupported_) {
        (void) [map putWithId:@"_id" withId:[id_ substring:1]];
      }
      else {
        @throw [[CCPBVMessageException alloc] initWithNSString:[RAREPlatform getResourceAsStringWithNSString:@"bv.text.no_id_search"]];
      }
    }
    else if (ComSparsewareBellavistaExternalFhirUtilPatients_identifierSearchSupported_ && [id_ hasPrefix:@"@"]) {
      (void) [map putWithId:@"identifier" withId:[id_ substring:1]];
    }
    else if (ComSparsewareBellavistaExternalFhirUtilPatients_nameComponentsSearchSupported_ && (n = [id_ indexOf:',']) != -1) {
      s = [((NSString *) nil_chk([id_ substring:0 endIndex:n])) trim];
      if ([((NSString *) nil_chk(s)) sequenceLength] != 0) {
        (void) [map putWithId:@"family" withId:s];
      }
      s = [((NSString *) nil_chk([id_ substring:n + 1])) trim];
      if ([((NSString *) nil_chk(s)) sequenceLength] != 0) {
        (void) [map putWithId:@"given" withId:s];
      }
    }
    else if (ComSparsewareBellavistaExternalFhirUtilPatients_nameComponentsSearchSupported_ && (n = [id_ lastIndexOf:' ']) != -1) {
      s = [((NSString *) nil_chk([id_ substring:n + 1])) trim];
      if ([((NSString *) nil_chk(s)) sequenceLength] != 0) {
        (void) [map putWithId:@"given" withId:s];
      }
      s = [((NSString *) nil_chk([id_ substring:0 endIndex:n])) trim];
      if ([((NSString *) nil_chk(s)) sequenceLength] != 0) {
        (void) [map putWithId:@"family" withId:s];
      }
    }
    else if (ComSparsewareBellavistaExternalFhirUtilPatients_dobSearchSupported_ && (([id_ indexOf:'/'] != -1) || ([id_ indexOf:'.'] != -1))) {
      [self setBirthDateWithJavaUtilMap:map withNSString:id_];
    }
    else if (ComSparsewareBellavistaExternalFhirUtilPatients_identifierSearchSupported_ && ([id_ indexOf:'-'] != -1)) {
      if ([((JavaUtilRegexMatcher *) nil_chk([((JavaUtilRegexPattern *) nil_chk(ssnPattern_)) matcherWithJavaLangCharSequence:id_])) matches] || ![self isPosibleDateWithNSString:id_]) {
        (void) [map putWithId:@"identifier" withId:id_];
      }
      else {
        [self setBirthDateWithJavaUtilMap:map withNSString:id_];
      }
    }
    else {
      (void) [map putWithId:@"name" withId:id_];
    }
    if (gender != nil) {
      (void) [map putWithId:@"gender" withId:gender];
    }
    if (count != nil) {
      (void) [map putWithId:@"_count" withId:count];
    }
    l = [((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_)) createLinkWithNSString:@"Patient" withNSStringArray:[IOSObjectArray arrayWithLength:0 type:[IOSClass classWithClass:[NSString class]]]];
    [((RAREActionLink *) nil_chk(l)) setAttributesWithJavaUtilMap:(id<JavaUtilMap>) check_protocol_cast(map, @protocol(JavaUtilMap))];
  }
  else {
    l = [((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_)) createJSONLinkWithNSString:href];
    if ((count != nil) && ([map getWithId:@"_count"] == nil)) {
      (void) [map putWithId:@"_count" withId:count];
    }
    [((RAREActionLink *) nil_chk(l)) setAttributesWithJavaUtilMap:(id<JavaUtilMap>) check_protocol_cast(map, @protocol(JavaUtilMap))];
  }
  @try {
    [self searchWithJavaIoReader:[((RAREActionLink *) nil_chk(l)) getReader] withId:[conn getContentWriter] withCCPBVHttpHeaders:headers withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ [JavaLangBoolean valueOfWithBoolean:YES] } count:1 type:[IOSClass classWithClass:[NSObject class]]]];
  }
  @finally {
    [((RAREActionLink *) nil_chk(l)) close];
  }
}

- (void)most_recentWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                        withCCPBVActionPath:(CCPBVActionPath *)path
                      withJavaIoInputStream:(JavaIoInputStream *)data
                       withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
  [((CCPBVHttpHeaders *) nil_chk(headers)) setDefaultResponseHeaders];
  [headers mimeRow];
  CCPBVContentWriter *w = [((id<CCPBViHttpConnection>) nil_chk(conn)) getContentWriter];
  for (NSString * __strong s in nil_chk(ComSparsewareBellavistaExternalFhirUtilPatients_mostRecent_)) {
    [((CCPBVContentWriter *) nil_chk(w)) writeWithNSString:s];
    [w writeWithInt:0x000a];
  }
}

- (void)my_patientsWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                        withCCPBVActionPath:(CCPBVActionPath *)path
                      withJavaIoInputStream:(JavaIoInputStream *)data
                       withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
  RAREActionLink *l = [((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_)) createLinkWithNSString:@"Patient" withNSStringArray:[IOSObjectArray arrayWithObjects:(id[]){ @"provider", [CCPBVUtils getUserID] } count:2 type:[IOSClass classWithClass:[NSString class]]]];
  @try {
    [self searchWithJavaIoReader:[((RAREActionLink *) nil_chk(l)) getReader] withId:[((id<CCPBViHttpConnection>) nil_chk(conn)) getContentWriter] withCCPBVHttpHeaders:headers withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ [JavaLangBoolean valueOfWithBoolean:YES] } count:1 type:[IOSClass classWithClass:[NSObject class]]]];
  }
  @finally {
    [((RAREActionLink *) nil_chk(l)) close];
  }
}

- (void)nearbyWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                   withCCPBVActionPath:(CCPBVActionPath *)path
                 withJavaIoInputStream:(JavaIoInputStream *)data
                  withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
}

- (void)selectWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                   withCCPBVActionPath:(CCPBVActionPath *)path
                 withJavaIoInputStream:(JavaIoInputStream *)data
                  withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
  NSString *id_ = [((CCPBVActionPath *) nil_chk(path)) shift];
  if (id_ == nil) {
    @throw [[CCPBVMessageException alloc] initWithNSString:@"missing id for select"];
  }
  int n = [((NSString *) nil_chk(id_)) indexOf:'.'];
  if (n != -1) {
    id_ = [id_ substring:0 endIndex:n];
  }
  RAREActionLink *l = [((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_)) createLinkWithNSString:[NSString stringWithFormat:@"Patient/%@", id_] withNSStringArray:[IOSObjectArray arrayWithLength:0 type:[IOSClass classWithClass:[NSString class]]]];
  @try {
    [self readWithJavaIoReader:[((RAREActionLink *) nil_chk(l)) getReader] withId:[((id<CCPBViHttpConnection>) nil_chk(conn)) getContentWriter] withCCPBVHttpHeaders:headers withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ [JavaLangBoolean valueOfWithBoolean:NO] } count:1 type:[IOSClass classWithClass:[NSObject class]]]];
  }
  @finally {
    [((RAREActionLink *) nil_chk(l)) close];
  }
}

- (RAREUTJSONObject *)getBestEncounterWithNSString:(NSString *)patient {
  RAREActionLink *l = [((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_)) createLinkWithNSString:@"Encounter" withNSStringArray:[IOSObjectArray arrayWithObjects:(id[]){ @"patient", patient } count:2 type:[IOSClass classWithClass:[NSString class]]]];
  RAREUTObjectHolder *oh = [[RAREUTObjectHolder alloc] initWithRAREUTObjectHolder:nil];
  oh->type_ = [JavaLangBoolean getFALSE];
  @try {
    RAREUTJSONTokener *t = [[RAREUTJSONTokener alloc] initWithJavaIoReader:[((RAREActionLink *) nil_chk(l)) getReader]];
    id<ComSparsewareBellavistaExternalFhirFHIRJSONWatcher_iCallback> cb = [[ComSparsewareBellavistaExternalFhirUtilPatients_$1 alloc] initWithRAREUTObjectHolder:oh withRAREUTJSONTokener:t];
    [t setWatcherWithRAREUTJSONTokener_iWatcher:[[ComSparsewareBellavistaExternalFhirFHIRJSONWatcher alloc] initWithComSparsewareBellavistaExternalFhirFHIRJSONWatcher_iCallback:cb]];
    (void) [[RAREUTJSONObject alloc] initWithRAREUTJSONTokener:t];
    [t dispose];
  }
  @finally {
    [((RAREActionLink *) nil_chk(l)) close];
  }
  return (RAREUTJSONObject *) check_class_cast(oh->value_, [RAREUTJSONObject class]);
}

- (BOOL)isPosibleDateWithNSString:(NSString *)id_ {
  int len = [((NSString *) nil_chk(id_)) sequenceLength];
  for (int i = 0; i < len; i++) {
    unichar c = [id_ charAtWithInt:i];
    if (![JavaLangCharacter isDigitWithChar:c] && ((c != '-') || (c != '/') || (c != '.'))) {
      return NO;
    }
  }
  return YES;
}

- (void)setBirthDateWithJavaUtilMap:(id<JavaUtilMap>)map
                       withNSString:(NSString *)id_ {
  @try {
    JavaUtilCalendar *cal = [JavaUtilCalendar getInstance];
    [RAREUTHelper setDateTimeWithNSString:id_ withJavaUtilCalendar:cal withBoolean:NO];
    (void) [((id<JavaUtilMap>) nil_chk(map)) putWithId:@"birthDate" withId:[((JavaTextSimpleDateFormat *) nil_chk(birthDate_)) formatWithJavaUtilDate:[((JavaUtilCalendar *) nil_chk(cal)) getTime]]];
  }
  @catch (JavaLangException *e) {
    (void) [((id<JavaUtilMap>) nil_chk(map)) putWithId:@"birthDate" withId:id_];
  }
}

- (void)processEntryWithId:(id)JSONArray
      withRAREUTJSONObject:(RAREUTJSONObject *)entry_
      withRAREUTJSONWriter:(RAREUTJSONWriter *)jw
          withJavaIoWriter:(JavaIoWriter *)w
       withRAREUTCharArray:(RAREUTCharArray *)ca
         withNSObjectArray:(IOSObjectArray *)params {
  JavaLangBoolean *forList = (int) [((IOSObjectArray *) nil_chk(params)) count] == 0 ? [JavaLangBoolean getTRUE] : (JavaLangBoolean *) check_class_cast(IOSObjectArray_Get(params, 0), [JavaLangBoolean class]);
  RAREUTJSONObject *o;
  RAREUTJSONObject *oo;
  BOOL parsed = NO;
  NSString *s;
  id<JavaUtilList> team = nil;
  JavaIoStringWriter *sw = [forList booleanValue] ? nil : [[JavaIoStringWriter alloc] init];
  do {
    NSString *id_ = nil;
    RAREUTJSONArray *name = nil;
    NSString *dob = nil;
    NSString *gender = nil;
    NSString *mrn = nil;
    NSString *providerld = nil;
    NSString *provider = nil;
    NSString *encounter_date = nil;
    NSString *encounter_reason = nil;
    NSString *locationld = nil;
    NSString *location = nil;
    NSString *rm_bed = nil;
    NSString *photo = nil;
    NSString *attendingld = nil;
    NSString *attending = nil;
    NSString *language = nil;
    NSString *relationshipld = @"PART";
    NSString *relationship = @"Participation";
    id_ = [((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_)) getIDWithNSString:[((RAREUTJSONObject *) nil_chk(entry_)) getStringWithNSString:@"id"] withBoolean:NO];
    name = [entry_ getJSONArrayWithNSString:@"name"];
    dob = [entry_ optStringWithNSString:@"birthDate" withNSString:nil];
    s = [entry_ optStringWithNSString:@"gender"];
    if ([((NSString *) nil_chk(s)) sequenceLength] > 0) {
      (void) [((RAREUTCharArray *) nil_chk(ca)) setWithNSString:s];
      (void) [ca toMixedCase];
      gender = [ca description];
    }
    RAREUTJSONArray *a = [entry_ optJSONArrayWithNSString:@"identifier"];
    if (a != nil) {
      mrn = [ComSparsewareBellavistaExternalFhirFHIRUtils getCodableConceptWithRAREUTJSONArray:a withNSString:@"mrn" withJavaUtilHashMap:ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_];
    }
    a = [entry_ optJSONArrayWithNSString:@"careProvider"];
    if ((a != nil) && ([a length] > 0)) {
      int len = [a length];
      for (int i = 0; i < len; i++) {
        o = [a getJSONObjectWithInt:i];
        s = [((RAREUTJSONObject *) nil_chk(o)) getStringWithNSString:@"reference"];
        if ([((NSString *) nil_chk(s)) contains:@"Practitioner/"]) {
          s = [server_ getIDWithNSString:s withBoolean:NO];
          if (provider == nil) {
            providerld = s;
            provider = [o optStringWithNSString:@"display"];
            break;
          }
        }
      }
    }
    a = [entry_ optJSONArrayWithNSString:@"photo"];
    if ((a != nil) && ([a length] > 0)) {
      o = [a getJSONObjectWithInt:0];
      s = [((RAREUTJSONObject *) nil_chk(o)) optStringWithNSString:@"data" withNSString:nil];
      if (s != nil) {
        NSString *type = [o optStringWithNSString:@"contentType" withNSString:@""];
        if ([((NSString *) nil_chk(type)) hasPrefix:@"image/"] && ([s sequenceLength] > 0)) {
          (void) [((RAREUTCharArray *) nil_chk([((RAREUTCharArray *) nil_chk([((RAREUTCharArray *) nil_chk([((RAREUTCharArray *) nil_chk(ca)) setWithNSString:@"data:"])) appendWithNSString:type])) appendWithNSString:@";base64,"])) appendWithNSString:s];
        }
      }
      else {
        s = [o optStringWithNSString:@"uri" withNSString:@""];
        if ([((NSString *) nil_chk(s)) hasPrefix:@"http"]) {
          photo = s;
        }
      }
    }
    if (![forList booleanValue]) {
      o = [self getBestEncounterWithNSString:id_];
      if (o != nil) {
        encounter_date = (NSString *) check_class_cast([o optWithNSStringArray:[IOSObjectArray arrayWithObjects:(id[]){ @"period", @"start" } count:2 type:[IOSClass classWithClass:[NSString class]]]], [NSString class]);
        encounter_reason = [ComSparsewareBellavistaExternalFhirFHIRUtils getBestMedicalTextWithRAREUTJSONObject:[o optJSONObjectWithNSString:@"reason"]];
        oo = [o optJSONObjectWithNSString:@"location"];
        if (oo != nil) {
          locationld = [server_ getIDWithNSString:[oo getStringWithNSString:@"reference"] withBoolean:NO];
          location = [oo optStringWithNSString:@"display"];
        }
        a = [o optJSONArrayWithNSString:@"participant"];
        if ((a != nil) && ([a length] > 0)) {
          team = [ComSparsewareBellavistaExternalFhirPatient parseParticipantWithComSparsewareBellavistaExternalFhirFHIRServer:server_ withRAREUTJSONArray:a];
          int len = [((id<JavaUtilList>) nil_chk(team)) size];
          NSString *me = [ComSparsewareBellavistaExternalFhirUtilUsers getPractitionerID];
          for (int i = 0; i < len; i++) {
            ComSparsewareBellavistaExternalFhirPatient_Practitioner *p = [team getWithInt:i];
            if ([((ComSparsewareBellavistaExternalFhirPatient_Practitioner *) nil_chk(p)) isAttending]) {
              attending = p->practitionerName_;
              attendingld = p->practitionerID_;
            }
            else if ([p isProvider]) {
              provider = p->practitionerName_;
              providerld = p->practitionerID_;
            }
            if (me != nil && [me isEqual:p->practitionerID_]) {
              relationship = p->typeName_;
              relationshipld = p->typeCode_;
              if (relationship == nil || [relationship sequenceLength] == 0) {
              }
            }
          }
        }
        a = [o optJSONArrayWithNSString:@"location"];
        if ((a != nil) && ([a length] > 0)) {
          int len = [a size];
          NSString *rm = nil;
          NSString *rmld = nil;
          NSString *bed = nil;
          NSString *bedld = nil;
          NSString *wingld = nil;
          for (int i = 0; i < len; i++) {
            oo = [((RAREUTJSONObject *) nil_chk([a getJSONObjectWithInt:i])) getJSONObjectWithNSString:@"location"];
            NSString *display = [((RAREUTJSONObject *) nil_chk(oo)) optStringWithNSString:@"display" withNSString:nil];
            if (display == nil) {
              display = [oo optStringWithNSString:@"name" withNSString:nil];
            }
            if (location == nil) {
              location = display;
            }
            s = [oo optStringWithNSString:@"status" withNSString:nil];
            if (s == nil || ![s isEqual:@"active"]) {
              continue;
            }
            NSString *ld = [server_ getIDWithNSString:[oo optStringWithNSString:@"id"] withBoolean:NO];
            s = [ComSparsewareBellavistaExternalFhirFHIRUtils getBestMedicalCodeWithRAREUTJSONObject:[oo optJSONObjectWithNSString:@"physicalType"]];
            if (s != nil) {
              if ([s isEqual:@"rm"]) {
                rm = display;
                rmld = ld;
              }
              else if ([s isEqual:@"bed"]) {
                bed = display;
                bedld = ld;
              }
              else if ([s isEqual:@"wing"]) {
                location = display;
                wingld = ld;
              }
            }
          }
          ((RAREUTCharArray *) nil_chk(ca))->_length_ = 0;
          if (rm != nil) {
            (void) [ca appendWithNSString:rm];
          }
          if (bed != nil) {
            (void) [ca appendWithChar:'-'];
            (void) [ca appendWithNSString:bed];
          }
          if (ca->_length_ != 0) {
            rm_bed = [ca description];
          }
          if (location == nil) {
            if (bed != nil) {
              location = [ComSparsewareBellavistaExternalFhirFHIRUtils getLocationParentNameWithNSString:bedld withInt:2];
              locationld = bedld;
            }
            else if (rm != nil) {
              location = [ComSparsewareBellavistaExternalFhirFHIRUtils getLocationParentNameWithNSString:rmld withInt:1];
              locationld = rmld;
            }
          }
          else if (locationld == nil) {
            locationld = wingld;
          }
          if (locationld == nil) {
            if (bed != nil) {
              locationld = bedld;
            }
            else if (rm != nil) {
              locationld = rmld;
            }
            else {
              locationld = wingld;
            }
          }
        }
      }
      a = [entry_ optJSONArrayWithNSString:@"communication"];
      if ((a != nil) && ([a length] > 0)) {
        int len = [a length];
        for (int i = 0; i < len; i++) {
          o = [a getJSONObjectWithInt:i];
          language = [ComSparsewareBellavistaExternalFhirFHIRUtils getBestMedicalTextWithRAREUTJSONObject:[((RAREUTJSONObject *) nil_chk(o)) optJSONObjectWithNSString:@"language"]];
          if ([o optBooleanWithNSString:@"preferred" withBoolean:NO]) {
            break;
          }
        }
      }
    }
    if (jw != nil) {
      (void) [jw object];
      if (id_ != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"id"])) valueWithId:id_];
      }
      if (name != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeNameWithId:jw withRAREUTJSONArray:name];
      }
      if (dob != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"dob"])) valueWithId:dob];
      }
      if (gender != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"gender"])) valueWithId:gender];
      }
      if (mrn != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"mrn"])) valueWithId:mrn];
      }
      if (provider != nil) {
        if (providerld != nil) {
          (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"provider"])) object];
          (void) [((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"linkedData"])) valueWithId:providerld])) keyWithNSString:@"value"])) valueWithId:provider];
          (void) [jw endObject];
        }
        else {
          (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"provider"])) valueWithId:provider];
        }
      }
      if (encounter_date != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"encounter_date"])) valueWithId:encounter_date];
      }
      if (encounter_reason != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"encounter_reason"])) valueWithId:encounter_reason];
      }
      if (location != nil) {
        if (locationld != nil) {
          (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"location"])) object];
          (void) [((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"linkedData"])) valueWithId:locationld])) keyWithNSString:@"value"])) valueWithId:location];
          (void) [jw endObject];
        }
        else {
          (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"location"])) valueWithId:location];
        }
      }
      if (rm_bed != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"rm_bed"])) valueWithId:rm_bed];
      }
      if (photo != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"photo"])) valueWithId:photo];
      }
      if (attending != nil) {
        if (attendingld != nil) {
          (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"attending"])) object];
          (void) [((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"linkedData"])) valueWithId:attendingld])) keyWithNSString:@"value"])) valueWithId:attending];
          (void) [jw endObject];
        }
        else {
          (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"attending"])) valueWithId:attending];
        }
      }
      if (language != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"language"])) valueWithId:language];
      }
      (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"relationship"])) object];
      (void) [((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"linkedData"])) valueWithId:relationshipld])) keyWithNSString:@"value"])) valueWithId:relationship];
      (void) [jw endObject];
      (void) [jw endObject];
    }
    if (w != nil) {
      if (id_ != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:id_ withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (name != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeNameWithId:w withRAREUTJSONArray:name];
      }
      [w writeWithInt:(unichar) '^'];
      if (dob != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:dob withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (gender != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:gender withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (mrn != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:mrn withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (provider != nil) {
        if (providerld != nil) {
          [w writeWithNSString:providerld];
          [w writeWithInt:(unichar) '|'];
        }
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:provider withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (encounter_date != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:encounter_date withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (encounter_reason != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:encounter_reason withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (location != nil) {
        if (locationld != nil) {
          [w writeWithNSString:locationld];
          [w writeWithInt:(unichar) '|'];
        }
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:location withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (rm_bed != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:rm_bed withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (photo != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:photo withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (attending != nil) {
        if (attendingld != nil) {
          [w writeWithNSString:attendingld];
          [w writeWithInt:(unichar) '|'];
        }
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:attending withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (language != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:language withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      [w writeWithNSString:relationshipld];
      [w writeWithInt:(unichar) '|'];
      [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:relationship withRAREUTCharArray:ca];
      [w writeWithInt:(unichar) '^'];
      [w writeWithInt:(unichar) '^'];
      [w writeWithInt:(unichar) 0x000a];
    }
    parsed = YES;
  }
  while (NO);
  if (!parsed) {
    [RAREPlatform debugLogWithNSString:[NSString stringWithFormat:@"Could not parse entry:\n%@", [((RAREUTJSONObject *) nil_chk(entry_)) toStringWithInt:2]]];
  }
  else if (sw != nil) {
    [((JavaUtilArrayList *) nil_chk(ComSparsewareBellavistaExternalFhirUtilPatients_most_recent__)) addWithInt:0 withId:[sw description]];
    if ([ComSparsewareBellavistaExternalFhirUtilPatients_most_recent__ size] > 5) {
      (void) [ComSparsewareBellavistaExternalFhirUtilPatients_most_recent__ removeWithInt:5];
    }
  }
}

+ (void)initialize {
  if (self == [ComSparsewareBellavistaExternalFhirUtilPatients class]) {
    ComSparsewareBellavistaExternalFhirUtilPatients_mostRecent_ = [[JavaUtilArrayList alloc] initWithInt:5];
    ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ = [[JavaUtilHashMap alloc] initWithInt:5];
    {
      (void) [ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ putWithId:@"mr" withId:@"mrn"];
      (void) [ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ putWithId:@"mrn" withId:@"mrn"];
      (void) [ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ putWithId:@"MR" withId:@"mrn"];
      (void) [ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ putWithId:@"MRN" withId:@"mrn"];
      (void) [ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ putWithId:@"ss" withId:@"ssn"];
      (void) [ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ putWithId:@"ssn" withId:@"ssn"];
      (void) [ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ putWithId:@"SS" withId:@"ssn"];
      (void) [ComSparsewareBellavistaExternalFhirUtilPatients_identifierMap_ putWithId:@"SSN" withId:@"ssn"];
    }
    ComSparsewareBellavistaExternalFhirUtilPatients_most_recent__ = [[JavaUtilArrayList alloc] initWithInt:5];
  }
}

- (void)copyAllFieldsTo:(ComSparsewareBellavistaExternalFhirUtilPatients *)other {
  [super copyAllFieldsTo:other];
  other->birthDate_ = birthDate_;
  other->ssnPattern_ = ssnPattern_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "by_categoryWithCCPBViHttpConnection:withCCPBVActionPath:withJavaIoInputStream:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "listWithCCPBViHttpConnection:withCCPBVActionPath:withJavaIoInputStream:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "most_recentWithCCPBViHttpConnection:withCCPBVActionPath:withJavaIoInputStream:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "my_patientsWithCCPBViHttpConnection:withCCPBVActionPath:withJavaIoInputStream:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "nearbyWithCCPBViHttpConnection:withCCPBVActionPath:withJavaIoInputStream:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "selectWithCCPBViHttpConnection:withCCPBVActionPath:withJavaIoInputStream:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "getBestEncounterWithNSString:", NULL, "LRAREUTJSONObject", 0x4, "JavaIoIOException" },
    { "isPosibleDateWithNSString:", NULL, "Z", 0x2, NULL },
    { "setBirthDateWithJavaUtilMap:withNSString:", NULL, "V", 0x2, NULL },
    { "processEntryWithId:withRAREUTJSONObject:withRAREUTJSONWriter:withJavaIoWriter:withRAREUTCharArray:withNSObjectArray:", NULL, "V", 0x84, "JavaIoIOException" },
  };
  static J2ObjcFieldInfo fields[] = {
    { "myPatientsSupported_", NULL, 0x8, "Z" },
    { "nameComponentsSearchSupported_", NULL, 0x8, "Z" },
    { "identifierSearchSupported_", NULL, 0x8, "Z" },
    { "idSearchSupported_", NULL, 0x8, "Z" },
    { "dobSearchSupported_", NULL, 0x8, "Z" },
    { "genderSearchSupported_", NULL, 0x8, "Z" },
    { "mostRecent_", NULL, 0x8, "LJavaUtilArrayList" },
    { "identifierMap_", NULL, 0x8, "LJavaUtilHashMap" },
    { "most_recent__", "most_recent", 0x8, "LJavaUtilArrayList" },
    { "ssnPattern_", NULL, 0x0, "LJavaUtilRegexPattern" },
    { "birthDate_", NULL, 0x0, "LJavaTextSimpleDateFormat" },
  };
  static J2ObjcClassInfo _ComSparsewareBellavistaExternalFhirUtilPatients = { "Patients", "com.sparseware.bellavista.external.fhir.util", NULL, 0x1, 10, methods, 11, fields, 0, NULL};
  return &_ComSparsewareBellavistaExternalFhirUtilPatients;
}

@end
@implementation ComSparsewareBellavistaExternalFhirUtilPatients_$1

- (id)entryEncounteredWithRAREUTJSONObject:(RAREUTJSONObject *)entry_ {
  @try {
    if (![@"in-progress" isEqual:((RAREUTObjectHolder *) nil_chk(val$oh_))->type_]) {
      entry_ = [((RAREUTJSONObject *) nil_chk(entry_)) getJSONObjectWithNSString:@"resource"];
      NSString *s = [((RAREUTJSONObject *) nil_chk(entry_)) getStringWithNSString:@"status"];
      if ([((NSString *) nil_chk(s)) isEqual:@"in-progress"]) {
        [((RAREUTJSONTokener *) nil_chk(val$t_)) setTerminateParsingWithBoolean:YES];
        val$oh_->value_ = entry_;
        val$oh_->type_ = s;
      }
      else if (val$oh_->value_ == nil || [s isEqual:@"arrived"]) {
        val$oh_->value_ = entry_;
        val$oh_->type_ = s;
      }
    }
  }
  @catch (JavaLangException *e) {
    [((JavaLangException *) nil_chk(e)) printStackTrace];
  }
  return nil;
}

- (id)initWithRAREUTObjectHolder:(RAREUTObjectHolder *)capture$0
           withRAREUTJSONTokener:(RAREUTJSONTokener *)capture$1 {
  val$oh_ = capture$0;
  val$t_ = capture$1;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "entryEncounteredWithRAREUTJSONObject:", NULL, "LNSObject", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "val$oh_", NULL, 0x1012, "LRAREUTObjectHolder" },
    { "val$t_", NULL, 0x1012, "LRAREUTJSONTokener" },
  };
  static J2ObjcClassInfo _ComSparsewareBellavistaExternalFhirUtilPatients_$1 = { "$1", "com.sparseware.bellavista.external.fhir.util", "Patients", 0x8000, 1, methods, 2, fields, 0, NULL};
  return &_ComSparsewareBellavistaExternalFhirUtilPatients_$1;
}

@end
