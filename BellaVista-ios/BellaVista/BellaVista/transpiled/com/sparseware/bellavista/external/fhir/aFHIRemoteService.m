//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: com/sparseware/bellavista/external/fhir/aFHIRemoteService.java
//
//  Created by decoteaud on 11/18/15.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/appnativa/rare/net/ActionLink.h"
#include "com/appnativa/util/CharArray.h"
#include "com/appnativa/util/json/JSONObject.h"
#include "com/appnativa/util/json/JSONTokener.h"
#include "com/appnativa/util/json/JSONWriter.h"
#include "com/sparseware/bellavista/external/fhir/FHIRJSONWatcher.h"
#include "com/sparseware/bellavista/external/fhir/FHIRServer.h"
#include "com/sparseware/bellavista/external/fhir/aFHIRemoteService.h"
#include "com/sparseware/bellavista/service/HttpHeaders.h"
#include "java/io/IOException.h"
#include "java/io/PrintStream.h"
#include "java/io/Reader.h"
#include "java/io/Writer.h"
#include "java/lang/Exception.h"
#include "java/lang/StringBuilder.h"
#include "java/lang/System.h"

@implementation ComSparsewareBellavistaExternalFhiraFHIRemoteService

- (id)init {
  if (self = [super init]) {
    server_ = [ComSparsewareBellavistaExternalFhirFHIRServer getInstance];
  }
  return self;
}

- (id)initWithNSString:(NSString *)resourceName {
  if (self = [super init]) {
    server_ = [ComSparsewareBellavistaExternalFhirFHIRServer getInstance];
    self->resourceName_ = resourceName;
    ComSparsewareBellavistaExternalFhirFHIRServer_FHIRResource *r = [((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_)) getResourceWithNSString:resourceName];
    summarySupported_ = r == nil ? NO : [r hasSearchParamWithNSString:@"_summary"];
  }
  return self;
}

- (RAREActionLink *)createSearchLinkWithNSStringArray:(IOSObjectArray *)params {
  JavaLangStringBuilder *sb = [[JavaLangStringBuilder alloc] initWithNSString:((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_))->endPoint_];
  (void) [((JavaLangStringBuilder *) nil_chk([sb appendWithChar:'/'])) appendWithNSString:resourceName_];
  (void) [sb appendWithChar:'?'];
  int i = 0;
  if (params != nil && (int) [params count] > 0) {
    if ((params != nil) && ((int) [params count] > 0)) {
      int len = (int) [params count];
      while (i < len) {
        if (i > 0) {
          (void) [sb appendWithChar:'&'];
        }
        (void) [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([sb appendWithNSString:IOSObjectArray_Get(params, i++)])) appendWithChar:'='])) appendWithNSString:IOSObjectArray_Get(params, i++)];
      }
    }
  }
  if (summarySupported_) {
    if (i > 0) {
      (void) [sb appendWithChar:'&'];
    }
    (void) [sb appendWithNSString:@"_summary=data"];
  }
  RAREActionLink *l = [[RAREActionLink alloc] initWithNSString:[sb description]];
  [l setRequestHeaderWithNSString:@"Accept" withNSString:@"application/json+fhir"];
  return l;
}

- (RAREActionLink *)createTextLinkWithNSString:(NSString *)id_ {
  JavaLangStringBuilder *sb = [[JavaLangStringBuilder alloc] initWithNSString:((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_))->endPoint_];
  (void) [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([sb appendWithChar:'/'])) appendWithNSString:resourceName_])) appendWithChar:'/'])) appendWithNSString:id_];
  ;
  if (summarySupported_) {
    (void) [sb appendWithNSString:@"?_summary=text"];
  }
  RAREActionLink *l = [[RAREActionLink alloc] initWithNSString:[sb description]];
  [l setRequestHeaderWithNSString:@"Accept" withNSString:@"application/json+fhir"];
  return l;
}

- (void)searchWithJavaIoReader:(JavaIoReader *)r
                        withId:(id)writer
          withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers
             withNSObjectArray:(IOSObjectArray *)params {
  RAREUTJSONWriter *jw;
  JavaIoWriter *w;
  RAREUTCharArray *ca = [[RAREUTCharArray alloc] init];
  if ([writer isKindOfClass:[RAREUTJSONWriter class]]) {
    jw = (RAREUTJSONWriter *) check_class_cast(writer, [RAREUTJSONWriter class]);
    w = nil;
  }
  else {
    w = (JavaIoWriter *) check_class_cast(writer, [JavaIoWriter class]);
    jw = nil;
  }
  if (jw != nil) {
    (void) [jw object];
    (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"_columns"])) array];
    {
      IOSObjectArray *a__ = columnNames_;
      id const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
      id const *e__ = b__ + a__->size_;
      while (b__ < e__) {
        NSString *name = (*b__++);
        (void) [jw valueWithId:name];
      }
    }
    (void) [jw endArray];
    (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"_rows"])) array];
  }
  RAREUTJSONTokener *t = [[RAREUTJSONTokener alloc] initWithJavaIoReader:r];
  RAREUTCharArray *sb = [[RAREUTCharArray alloc] init];
  id<ComSparsewareBellavistaExternalFhirFHIRJSONWatcher_iCallback> cb = [[ComSparsewareBellavistaExternalFhiraFHIRemoteService_$1 alloc] initWithComSparsewareBellavistaExternalFhiraFHIRemoteService:self withRAREUTJSONWriter:jw withJavaIoWriter:w withRAREUTCharArray:ca withNSObjectArray:params withCCPBVHttpHeaders:headers];
  [t setWatcherWithRAREUTJSONTokener_iWatcher:[[ComSparsewareBellavistaExternalFhirFHIRJSONWatcher alloc] initWithComSparsewareBellavistaExternalFhirFHIRJSONWatcher_iCallback:cb]];
  RAREUTJSONObject *o = [[RAREUTJSONObject alloc] initWithRAREUTJSONTokener:t];
  [t dispose];
  [self parsingCompleteWithRAREUTJSONWriter:jw withJavaIoWriter:w withRAREUTCharArray:ca withNSObjectArray:params];
  if (jw != nil) {
    (void) [jw endArray];
    (void) [jw endObject];
  }
}

- (void)readWithJavaIoReader:(JavaIoReader *)r
                      withId:(id)writer
        withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers
           withNSObjectArray:(IOSObjectArray *)params {
  RAREUTJSONWriter *jw;
  JavaIoWriter *w;
  RAREUTCharArray *ca = [[RAREUTCharArray alloc] init];
  if ([writer isKindOfClass:[RAREUTJSONWriter class]]) {
    jw = (RAREUTJSONWriter *) check_class_cast(writer, [RAREUTJSONWriter class]);
    w = nil;
  }
  else {
    w = (JavaIoWriter *) check_class_cast(writer, [JavaIoWriter class]);
    jw = nil;
  }
  if (jw != nil) {
    (void) [jw object];
    (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"_columns"])) array];
    {
      IOSObjectArray *a__ = columnNames_;
      id const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
      id const *e__ = b__ + a__->size_;
      while (b__ < e__) {
        NSString *name = (*b__++);
        (void) [jw valueWithId:name];
      }
    }
    (void) [jw endArray];
    (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"_rows"])) array];
  }
  RAREUTJSONTokener *t = [[RAREUTJSONTokener alloc] initWithJavaIoReader:r];
  RAREUTJSONObject *o = [[RAREUTJSONObject alloc] initWithRAREUTJSONTokener:t];
  [t dispose];
  [self processEntryWithRAREUTJSONObject:o withRAREUTJSONWriter:jw withJavaIoWriter:w withRAREUTCharArray:ca withNSObjectArray:params];
  [self parsingCompleteWithRAREUTJSONWriter:jw withJavaIoWriter:w withRAREUTCharArray:ca withNSObjectArray:params];
  if (jw != nil) {
    (void) [jw endArray];
    (void) [jw endObject];
  }
}

- (void)parsingCompleteWithRAREUTJSONWriter:(RAREUTJSONWriter *)jw
                           withJavaIoWriter:(JavaIoWriter *)w
                        withRAREUTCharArray:(RAREUTCharArray *)ca
                          withNSObjectArray:(IOSObjectArray *)params {
}

- (void)processResourceWithRAREUTJSONObject:(RAREUTJSONObject *)resource
                       withRAREUTJSONWriter:(RAREUTJSONWriter *)jw
                           withJavaIoWriter:(JavaIoWriter *)w
                        withRAREUTCharArray:(RAREUTCharArray *)ca
                          withNSObjectArray:(IOSObjectArray *)params {
  [self processEntryWithRAREUTJSONObject:[((RAREUTJSONObject *) nil_chk(resource)) getJSONObjectWithNSString:@"resource"] withRAREUTJSONWriter:jw withJavaIoWriter:w withRAREUTCharArray:ca withNSObjectArray:params];
}

- (NSString *)getIDWithRAREUTJSONObject:(RAREUTJSONObject *)entry_ {
  NSString *id_ = [((RAREUTJSONObject *) nil_chk(entry_)) optStringWithNSString:@"id" withNSString:nil];
  if (id_ != nil) {
    int n = [id_ lastIndexOf:'/'];
    if (n != -1) {
      id_ = [id_ substring:n];
    }
  }
  return id_;
}

- (NSString *)getIDWithNSString:(NSString *)id_ {
  if (id_ != nil) {
    int n = [id_ lastIndexOf:'/'];
    if (n != -1) {
      id_ = [id_ substring:n];
    }
  }
  return id_;
}

- (void)processEntryWithRAREUTJSONObject:(RAREUTJSONObject *)entry_
                    withRAREUTJSONWriter:(RAREUTJSONWriter *)jw
                        withJavaIoWriter:(JavaIoWriter *)w
                     withRAREUTCharArray:(RAREUTCharArray *)ca
                       withNSObjectArray:(IOSObjectArray *)params {
}

- (void)copyAllFieldsTo:(ComSparsewareBellavistaExternalFhiraFHIRemoteService *)other {
  [super copyAllFieldsTo:other];
  other->columnNames_ = columnNames_;
  other->resourceName_ = resourceName_;
  other->server_ = server_;
  other->summarySupported_ = summarySupported_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "createSearchLinkWithNSStringArray:", NULL, "LRAREActionLink", 0x84, NULL },
    { "createTextLinkWithNSString:", NULL, "LRAREActionLink", 0x4, NULL },
    { "searchWithJavaIoReader:withId:withCCPBVHttpHeaders:withNSObjectArray:", NULL, "V", 0x84, "JavaIoIOException" },
    { "readWithJavaIoReader:withId:withCCPBVHttpHeaders:withNSObjectArray:", NULL, "V", 0x84, "JavaIoIOException" },
    { "parsingCompleteWithRAREUTJSONWriter:withJavaIoWriter:withRAREUTCharArray:withNSObjectArray:", NULL, "V", 0x84, "JavaIoIOException" },
    { "processResourceWithRAREUTJSONObject:withRAREUTJSONWriter:withJavaIoWriter:withRAREUTCharArray:withNSObjectArray:", NULL, "V", 0x84, "JavaIoIOException" },
    { "getIDWithRAREUTJSONObject:", NULL, "LNSString", 0x4, NULL },
    { "getIDWithNSString:", NULL, "LNSString", 0x4, NULL },
    { "processEntryWithRAREUTJSONObject:withRAREUTJSONWriter:withJavaIoWriter:withRAREUTCharArray:withNSObjectArray:", NULL, "V", 0x84, "JavaIoIOException" },
  };
  static J2ObjcFieldInfo fields[] = {
    { "server_", NULL, 0x4, "LComSparsewareBellavistaExternalFhirFHIRServer" },
    { "columnNames_", NULL, 0x4, "LIOSObjectArray" },
    { "summarySupported_", NULL, 0x4, "Z" },
    { "resourceName_", NULL, 0x0, "LNSString" },
  };
  static J2ObjcClassInfo _ComSparsewareBellavistaExternalFhiraFHIRemoteService = { "aFHIRemoteService", "com.sparseware.bellavista.external.fhir", NULL, 0x401, 9, methods, 4, fields, 0, NULL};
  return &_ComSparsewareBellavistaExternalFhiraFHIRemoteService;
}

@end
@implementation ComSparsewareBellavistaExternalFhiraFHIRemoteService_$1

- (id)entryEncounteredWithRAREUTJSONObject:(RAREUTJSONObject *)entry_ {
  @try {
    [this$0_ processResourceWithRAREUTJSONObject:entry_ withRAREUTJSONWriter:val$jw_ withJavaIoWriter:val$w_ withRAREUTCharArray:val$ca_ withNSObjectArray:val$params_];
  }
  @catch (JavaLangException *e) {
    [((JavaLangException *) nil_chk(e)) printStackTrace];
  }
  return nil;
}

- (id)linkEncounteredWithNSString:(NSString *)arrayName
                     withNSString:(NSString *)type
                     withNSString:(NSString *)url {
  if ([@"link" isEqual:arrayName]) {
    if ([((NSString *) nil_chk(type)) isEqual:@"next"]) {
      [((CCPBVHttpHeaders *) nil_chk(val$headers_)) hasMoreWithNSString:url];
    }
    else if ([type isEqual:@"self"]) {
      [((CCPBVHttpHeaders *) nil_chk(val$headers_)) setLinkInfoWithNSString:@"url"];
    }
  }
  else {
    [((JavaIoPrintStream *) nil_chk([JavaLangSystem out])) printlnWithNSString:arrayName];
  }
  return nil;
}

- (id)initWithComSparsewareBellavistaExternalFhiraFHIRemoteService:(ComSparsewareBellavistaExternalFhiraFHIRemoteService *)outer$
                                              withRAREUTJSONWriter:(RAREUTJSONWriter *)capture$0
                                                  withJavaIoWriter:(JavaIoWriter *)capture$1
                                               withRAREUTCharArray:(RAREUTCharArray *)capture$2
                                                 withNSObjectArray:(IOSObjectArray *)capture$3
                                              withCCPBVHttpHeaders:(CCPBVHttpHeaders *)capture$4 {
  this$0_ = outer$;
  val$jw_ = capture$0;
  val$w_ = capture$1;
  val$ca_ = capture$2;
  val$params_ = capture$3;
  val$headers_ = capture$4;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "entryEncounteredWithRAREUTJSONObject:", NULL, "LNSObject", 0x1, NULL },
    { "linkEncounteredWithNSString:withNSString:withNSString:", NULL, "LNSObject", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "LComSparsewareBellavistaExternalFhiraFHIRemoteService" },
    { "val$jw_", NULL, 0x1012, "LRAREUTJSONWriter" },
    { "val$w_", NULL, 0x1012, "LJavaIoWriter" },
    { "val$ca_", NULL, 0x1012, "LRAREUTCharArray" },
    { "val$params_", NULL, 0x1012, "LIOSObjectArray" },
    { "val$headers_", NULL, 0x1012, "LCCPBVHttpHeaders" },
  };
  static J2ObjcClassInfo _ComSparsewareBellavistaExternalFhiraFHIRemoteService_$1 = { "$1", "com.sparseware.bellavista.external.fhir", "aFHIRemoteService", 0x8000, 2, methods, 6, fields, 0, NULL};
  return &_ComSparsewareBellavistaExternalFhiraFHIRemoteService_$1;
}

@end
