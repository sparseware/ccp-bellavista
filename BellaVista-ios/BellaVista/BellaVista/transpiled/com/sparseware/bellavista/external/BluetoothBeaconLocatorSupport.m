//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: com/sparseware/bellavista/external/BluetoothBeaconLocatorSupport.java
//
//  Created by decoteaud on 3/24/15.
//

#include "com/appnativa/rare/ui/event/iChangeListener.h"
#include "com/sparseware/bellavista/external/BluetoothBeaconLocatorSupport.h"
#include "com/sparseware/bellavista/external/aBeaconLocator.h"
#include "com/sparseware/bellavista/external/aBeaconLocatorSupport.h"
#include "com/sparseware/bellavista/external/aPatientLocator.h"
#include "java/util/ArrayList.h"
#include "java/util/Collections.h"
#include "java/util/List.h"
#import "BVBeaconMonitor.h"

@implementation CCPBVBluetoothBeaconLocatorSupport

- (id)init {
  if (self = [super init]) {
    monitors_ = [[JavaUtilArrayList alloc] initWithInt:2];
    monitorProxy_ = [CCPBVBluetoothBeaconLocatorSupport createProxyWithCCPBVBluetoothBeaconLocatorSupport:self];
  }
  return self;
}

- (void)dispose {
  [super dispose];
  [self disposeNative];
  monitorProxy_ = nil;
  if (monitors_ != nil) {
    for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in monitors_) {
      [((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m)) dispose];
    }
    [monitors_ clear];
  }
  monitors_ = nil;
}

- (BOOL)isAvailable {
  return [self wasAccessGranted] || [self isAccessPending];
}

- (BOOL)wasAccessDenied {
  return ![self wasAccessGranted] && ![self isAccessPending];
}

- (void)setLocationBeaconsWithJavaUtilList:(id<JavaUtilList>)beacons {
  [self setBeaconsWithCCPBVaPatientLocator_LocatorChangeTypeEnum:[CCPBVaPatientLocator_LocatorChangeTypeEnum LOCATIONS] withJavaUtilList:beacons];
}

- (void)setPatientBeaconsWithJavaUtilList:(id<JavaUtilList>)beacons {
  [self setBeaconsWithCCPBVaPatientLocator_LocatorChangeTypeEnum:[CCPBVaPatientLocator_LocatorChangeTypeEnum PATIENTS] withJavaUtilList:beacons];
}

- (void)startListeningForLocations {
  for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
    if (((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m))->type_ == [CCPBVaPatientLocator_LocatorChangeTypeEnum LOCATIONS]) {
      [m start];
    }
  }
}

- (void)startListeningForPatients {
  for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
    if (((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m))->type_ == [CCPBVaPatientLocator_LocatorChangeTypeEnum PATIENTS]) {
      [m start];
    }
  }
}

- (void)stopListeningForLocations {
  for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
    if (((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m))->type_ == [CCPBVaPatientLocator_LocatorChangeTypeEnum LOCATIONS]) {
      [m stop];
    }
  }
}

- (void)stopListeningForPatients {
  for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
    if (((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m))->type_ == [CCPBVaPatientLocator_LocatorChangeTypeEnum PATIENTS]) {
      [m stop];
    }
  }
}

- (void)accessChangedWithBoolean:(BOOL)granted {
  if (granted) {
    for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
      if (((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m))->monitoring_) {
        [self startMonitoringWithJavaUtilList:m->beacons_];
      }
    }
  }
  else if (changeListener_ != nil) {
    [changeListener_ stateChangedWithJavaUtilEventObject:[[CCPBVaPatientLocator_LocatorChangeEvent alloc] initWithId:self withCCPBVaPatientLocator_LocatorChangeTypeEnum:[CCPBVaPatientLocator_LocatorChangeTypeEnum ACCESS_DENIED]]];
  }
}

- (void)beginRangingBeacons {
  for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
    [((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m)) clearRangedBeacons];
  }
}

- (void)noBeaconInrange {
  for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
    if (((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m))->rangedBeacons_ != nil) {
      [self notifyWithJavaUtilList:[JavaUtilCollections EMPTY_LIST] withBoolean:m->type_ == [CCPBVaPatientLocator_LocatorChangeTypeEnum PATIENTS]];
    }
    [m clearRangedBeacons];
  }
}

- (void)endRangingBeacons {
  for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
    if (((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m))->rangedBeacons_ != nil) {
      [self notifyWithJavaUtilList:m->rangedBeacons_ withBoolean:m->type_ == [CCPBVaPatientLocator_LocatorChangeTypeEnum PATIENTS]];
    }
  }
}

- (BOOL)isMemberWithJavaUtilList:(id<JavaUtilList>)list
                    withNSString:(NSString *)uuid
                         withInt:(int)major {
  for (CCPBVaBeaconLocator_Beacon * __strong b in nil_chk(list)) {
    if ([((CCPBVaBeaconLocator_Beacon *) nil_chk(b)) isOneOfMineWithNSString:uuid withInt:major]) {
      return YES;
    }
  }
  return NO;
}

- (void)rangedBeaconWithNSString:(NSString *)uuid
                         withInt:(int)major
                         withInt:(int)minor
                       withFloat:(float)proximity
                    withNSString:(NSString *)identifier {
  for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
    if ([((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m)) rangedBeaconWithNSString:uuid withInt:major withInt:minor withFloat:proximity withNSString:identifier]) {
      break;
    }
  }
}

- (void)startMonitoringWithJavaUtilList:(id<JavaUtilList>)beacons {
  for (CCPBVaBeaconLocator_Beacon * __strong b in nil_chk(beacons)) {
    [self startMonitoringWithNSString:((CCPBVaBeaconLocator_Beacon *) nil_chk(b))->uuid_ withInt:b->major_ withInt:b->minor_ withNSString:b->uuid_];
  }
}

- (void)stopMonitoringWithJavaUtilList:(id<JavaUtilList>)beacons {
  for (CCPBVaBeaconLocator_Beacon * __strong b in nil_chk(beacons)) {
    [self stopMonitoringWithNSString:((CCPBVaBeaconLocator_Beacon *) nil_chk(b))->uuid_];
  }
}

- (void)setBeaconsWithCCPBVaPatientLocator_LocatorChangeTypeEnum:(CCPBVaPatientLocator_LocatorChangeTypeEnum *)type
                                                withJavaUtilList:(id<JavaUtilList>)beacons {
  CCPBVBluetoothBeaconLocatorSupport_Monitor *bm = nil;
  for (CCPBVBluetoothBeaconLocatorSupport_Monitor * __strong m in nil_chk(monitors_)) {
    if (((CCPBVBluetoothBeaconLocatorSupport_Monitor *) nil_chk(m))->type_ == type) {
      bm = m;
      break;
    }
  }
  if (bm == nil) {
    bm = [[CCPBVBluetoothBeaconLocatorSupport_Monitor alloc] initWithCCPBVBluetoothBeaconLocatorSupport:self withCCPBVaPatientLocator_LocatorChangeTypeEnum:type withJavaUtilList:beacons];
    [monitors_ addWithId:bm];
  }
  else {
    if (bm->monitoring_) {
      [bm stop];
      bm->beacons_ = beacons;
      [bm start];
    }
    else {
      bm->beacons_ = beacons;
    }
  }
}

- (void)disposeNative {
  [(CCPBVBeaconMonitor*)monitorProxy_ dispose];
}

- (BOOL)isAccessPending {
  return [(CCPBVBeaconMonitor*)monitorProxy_ isAccessPending];
}

- (void)startMonitoringWithNSString:(NSString *)uuid
                            withInt:(int)bmajor
                            withInt:(int)bminor
                       withNSString:(NSString *)identifier {
  CCPBVBeaconMonitor* monitor=(CCPBVBeaconMonitor*)monitorProxy_;
  [monitor startMonitoringBeacon:uuid major:bmajor minor:bmajor identifier:identifier];
}

- (void)stopMonitoringWithNSString:(NSString *)identifier {
  CCPBVBeaconMonitor* monitor=(CCPBVBeaconMonitor*)monitorProxy_;
  [monitor stopMonitoringIdentifier:identifier];
}

- (BOOL)wasAccessGranted {
  return [(CCPBVBeaconMonitor*)monitorProxy_ wasAccessGranted];
}

+ (id)createProxyWithCCPBVBluetoothBeaconLocatorSupport:(CCPBVBluetoothBeaconLocatorSupport *)bbs {
  return [[CCPBVBeaconMonitor alloc] initWithLocatorSupport: bbs];
}

- (void)copyAllFieldsTo:(CCPBVBluetoothBeaconLocatorSupport *)other {
  [super copyAllFieldsTo:other];
  other->monitorProxy_ = monitorProxy_;
  other->monitors_ = monitors_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "isAvailable", NULL, "Z", 0x1, NULL },
    { "wasAccessDenied", NULL, "Z", 0x1, NULL },
    { "accessChangedWithBoolean:", NULL, "V", 0x4, NULL },
    { "beginRangingBeacons", NULL, "V", 0x4, NULL },
    { "noBeaconInrange", NULL, "V", 0x4, NULL },
    { "endRangingBeacons", NULL, "V", 0x4, NULL },
    { "isMemberWithJavaUtilList:withNSString:withInt:", NULL, "Z", 0x4, NULL },
    { "rangedBeaconWithNSString:withInt:withInt:withFloat:withNSString:", NULL, "V", 0x4, NULL },
    { "startMonitoringWithJavaUtilList:", NULL, "V", 0x0, NULL },
    { "stopMonitoringWithJavaUtilList:", NULL, "V", 0x0, NULL },
    { "setBeaconsWithCCPBVaPatientLocator_LocatorChangeTypeEnum:withJavaUtilList:", NULL, "V", 0x0, NULL },
    { "disposeNative", NULL, "V", 0x100, NULL },
    { "isAccessPending", NULL, "Z", 0x100, NULL },
    { "startMonitoringWithNSString:withInt:withInt:withNSString:", NULL, "V", 0x100, NULL },
    { "stopMonitoringWithNSString:", NULL, "V", 0x100, NULL },
    { "wasAccessGranted", NULL, "Z", 0x100, NULL },
    { "createProxyWithCCPBVBluetoothBeaconLocatorSupport:", NULL, "LNSObject", 0x108, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "monitorProxy_", NULL, 0x0, "LNSObject" },
    { "monitors_", NULL, 0x0, "LJavaUtilArrayList" },
  };
  static J2ObjcClassInfo _CCPBVBluetoothBeaconLocatorSupport = { "BluetoothBeaconLocatorSupport", "com.sparseware.bellavista.external", NULL, 0x1, 17, methods, 2, fields, 0, NULL};
  return &_CCPBVBluetoothBeaconLocatorSupport;
}

@end
@implementation CCPBVBluetoothBeaconLocatorSupport_Monitor

- (id)initWithCCPBVBluetoothBeaconLocatorSupport:(CCPBVBluetoothBeaconLocatorSupport *)outer$
  withCCPBVaPatientLocator_LocatorChangeTypeEnum:(CCPBVaPatientLocator_LocatorChangeTypeEnum *)type
                                withJavaUtilList:(id<JavaUtilList>)beacons {
  this$0_ = outer$;
  if (self = [super init]) {
    self->type_ = type;
    self->beacons_ = beacons;
  }
  return self;
}

- (void)addRangedBeaconWithCCPBVaBeaconLocator_Beacon:(CCPBVaBeaconLocator_Beacon *)beacon {
  if (rangedBeacons_ == nil) {
    rangedBeacons_ = [[JavaUtilArrayList alloc] initWithInt:5];
  }
  [((id<JavaUtilList>) nil_chk(rangedBeacons_)) addWithId:beacon];
}

- (void)clearRangedBeacons {
  rangedBeacons_ = nil;
}

- (void)dispose {
  beacons_ = nil;
  rangedBeacons_ = nil;
}

- (id<JavaUtilList>)getBeaconsWithJavaUtilList:(id<JavaUtilList>)outArg {
  if (beacons_ != nil && ![beacons_ isEmpty]) {
    if (outArg != nil) {
      [outArg addAllWithJavaUtilCollection:beacons_];
    }
    else {
      outArg = beacons_;
    }
  }
  return outArg;
}

- (BOOL)rangedBeaconWithNSString:(NSString *)uuid
                         withInt:(int)major
                         withInt:(int)minor
                       withFloat:(float)proximity
                    withNSString:(NSString *)identifier {
  for (CCPBVaBeaconLocator_Beacon * __strong b in nil_chk(beacons_)) {
    if ([((CCPBVaBeaconLocator_Beacon *) nil_chk(b)) isOneOfMineWithNSString:uuid withInt:major]) {
      [self addRangedBeaconWithCCPBVaBeaconLocator_Beacon:[[CCPBVaBeaconLocator_Beacon alloc] initWithNSString:uuid withInt:major withInt:minor withFloat:proximity]];
      return YES;
    }
  }
  return NO;
}

- (void)start {
  if (!monitoring_) {
    monitoring_ = YES;
    [this$0_ startMonitoringWithJavaUtilList:beacons_];
  }
}

- (void)stop {
  if (monitoring_) {
    monitoring_ = NO;
    [this$0_ stopMonitoringWithJavaUtilList:beacons_];
  }
}

- (void)copyAllFieldsTo:(CCPBVBluetoothBeaconLocatorSupport_Monitor *)other {
  [super copyAllFieldsTo:other];
  other->beacons_ = beacons_;
  other->monitoring_ = monitoring_;
  other->rangedBeacons_ = rangedBeacons_;
  other->type_ = type_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "addRangedBeaconWithCCPBVaBeaconLocator_Beacon:", NULL, "V", 0x0, NULL },
    { "clearRangedBeacons", NULL, "V", 0x0, NULL },
    { "dispose", NULL, "V", 0x0, NULL },
    { "getBeaconsWithJavaUtilList:", NULL, "LJavaUtilList", 0x0, NULL },
    { "rangedBeaconWithNSString:withInt:withInt:withFloat:withNSString:", NULL, "Z", 0x0, NULL },
    { "start", NULL, "V", 0x0, NULL },
    { "stop", NULL, "V", 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "LCCPBVBluetoothBeaconLocatorSupport" },
    { "type_", NULL, 0x0, "LCCPBVaPatientLocator_LocatorChangeTypeEnum" },
    { "monitoring_", NULL, 0x0, "Z" },
    { "beacons_", NULL, 0x0, "LJavaUtilList" },
    { "rangedBeacons_", NULL, 0x0, "LJavaUtilList" },
  };
  static J2ObjcClassInfo _CCPBVBluetoothBeaconLocatorSupport_Monitor = { "Monitor", "com.sparseware.bellavista.external", "BluetoothBeaconLocatorSupport", 0x0, 7, methods, 5, fields, 0, NULL};
  return &_CCPBVBluetoothBeaconLocatorSupport_Monitor;
}

@end
