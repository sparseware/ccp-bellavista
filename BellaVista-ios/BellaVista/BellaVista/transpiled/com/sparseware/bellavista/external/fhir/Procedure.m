//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: com/sparseware/bellavista/external/fhir/Procedure.java
//
//  Created by decoteaud on 11/18/15.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/appnativa/rare/Platform.h"
#include "com/appnativa/rare/net/ActionLink.h"
#include "com/appnativa/util/CharArray.h"
#include "com/appnativa/util/json/JSONArray.h"
#include "com/appnativa/util/json/JSONObject.h"
#include "com/appnativa/util/json/JSONWriter.h"
#include "com/sparseware/bellavista/ActionPath.h"
#include "com/sparseware/bellavista/external/fhir/FHIRServer.h"
#include "com/sparseware/bellavista/external/fhir/FHIRUtils.h"
#include "com/sparseware/bellavista/external/fhir/Procedure.h"
#include "com/sparseware/bellavista/external/fhir/aFHIRemoteService.h"
#include "com/sparseware/bellavista/service/ContentWriter.h"
#include "com/sparseware/bellavista/service/HttpHeaders.h"
#include "com/sparseware/bellavista/service/aRemoteService.h"
#include "com/sparseware/bellavista/service/iHttpConnection.h"
#include "java/io/IOException.h"
#include "java/io/InputStream.h"
#include "java/io/Reader.h"
#include "java/io/Writer.h"

@implementation ComSparsewareBellavistaExternalFhirProcedure

- (id)init {
  if (self = [super initWithNSString:@"Procedure"]) {
    columnNames_ = [IOSObjectArray arrayWithObjects:(id[]){ @"date", @"title", @"status", @"type", @"has_attachments", @"parent_id" } count:6 type:[IOSClass classWithClass:[NSString class]]];
  }
  return self;
}

- (void)consultWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                    withCCPBVActionPath:(CCPBVActionPath *)path
                  withJavaIoInputStream:(JavaIoInputStream *)data
                   withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
  [self demoWithCCPBViHttpConnection:conn withCCPBVActionPath:path withJavaIoInputStream:data withCCPBVHttpHeaders:headers];
}

- (void)listWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                 withCCPBVActionPath:(CCPBVActionPath *)path
               withJavaIoInputStream:(JavaIoInputStream *)data
                withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
  RAREActionLink *l = [self createSearchLinkWithNSStringArray:[IOSObjectArray arrayWithObjects:(id[]){ @"patient", [((ComSparsewareBellavistaExternalFhirFHIRServer *) nil_chk(server_)) getPatientID] } count:2 type:[IOSClass classWithClass:[NSString class]]]];
  @try {
    id w = [ComSparsewareBellavistaExternalFhirFHIRUtils createWriterWithCCPBVActionPath:path withCCPBVContentWriter:[((id<CCPBViHttpConnection>) nil_chk(conn)) getContentWriter] withCCPBVHttpHeaders:headers withBoolean:YES];
    [self searchWithJavaIoReader:[((RAREActionLink *) nil_chk(l)) getReader] withId:w withCCPBVHttpHeaders:headers withNSObjectArray:[IOSObjectArray arrayWithLength:0 type:[IOSClass classWithClass:[NSObject class]]]];
  }
  @finally {
    [((RAREActionLink *) nil_chk(l)) close];
  }
}

- (void)processEntryWithRAREUTJSONObject:(RAREUTJSONObject *)entry_
                    withRAREUTJSONWriter:(RAREUTJSONWriter *)jw
                        withJavaIoWriter:(JavaIoWriter *)w
                     withRAREUTCharArray:(RAREUTCharArray *)ca
                       withNSObjectArray:(IOSObjectArray *)params {
  BOOL parsed = NO;
  do {
    NSString *dateld = [self getIDWithRAREUTJSONObject:entry_];
    NSString *date = [((RAREUTJSONObject *) nil_chk(entry_)) optStringWithNSString:@"performedDateTime" withNSString:nil];
    ;
    NSString *title = [ComSparsewareBellavistaExternalFhirFHIRUtils getBestMedicalTextWithRAREUTJSONObject:[entry_ getJSONObjectWithNSString:@"type"]];
    NSString *status = [entry_ getStringWithNSString:@"status"];
    NSString *type = @"P";
    NSString *has_attachments = nil;
    if (date == nil) {
      date = (NSString *) check_class_cast([entry_ optWithNSStringArray:[IOSObjectArray arrayWithObjects:(id[]){ @"performedPeriod", @"start" } count:2 type:[IOSClass classWithClass:[NSString class]]]], [NSString class]);
    }
    if (date == nil) {
      break;
    }
    RAREUTJSONArray *a = [entry_ optJSONArrayWithNSString:@"report"];
    has_attachments = (a != nil && [a length] > 0) ? @"true" : @"false";
    if (jw != nil) {
      (void) [jw object];
      if (date != nil) {
        if (dateld != nil) {
          (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"date"])) object];
          (void) [((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"linkedData"])) valueWithId:dateld])) keyWithNSString:@"value"])) valueWithId:date];
          (void) [jw endObject];
        }
        else {
          (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"date"])) valueWithId:date];
        }
      }
      if (title != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"title"])) valueWithId:title];
      }
      if (status != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"status"])) valueWithId:status];
      }
      if (type != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"type"])) valueWithId:type];
      }
      if (has_attachments != nil) {
        (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"has_attachments"])) valueWithId:has_attachments];
      }
      (void) [jw endObject];
    }
    else {
      if (date != nil) {
        if (dateld != nil) {
          [((JavaIoWriter *) nil_chk(w)) writeWithNSString:dateld];
          [w writeWithInt:(unichar) '|'];
        }
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:date withRAREUTCharArray:ca];
      }
      [((JavaIoWriter *) nil_chk(w)) writeWithInt:(unichar) '^'];
      if (title != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:title withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (status != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:status withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (type != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:type withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      if (has_attachments != nil) {
        [ComSparsewareBellavistaExternalFhirFHIRUtils writeQuotedStringIfNecessaryWithJavaIoWriter:w withNSString:has_attachments withRAREUTCharArray:ca];
      }
      [w writeWithInt:(unichar) '^'];
      [w writeWithInt:(unichar) '^'];
      [w writeWithInt:(unichar) 0x000a];
    }
    parsed = YES;
  }
  while (NO);
  if (!parsed) {
    [RAREPlatform debugLogWithNSString:[NSString stringWithFormat:@"Could not parse entry:\n%@", [((RAREUTJSONObject *) nil_chk(entry_)) toStringWithInt:2]]];
  }
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "consultWithCCPBViHttpConnection:withCCPBVActionPath:withJavaIoInputStream:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "listWithCCPBViHttpConnection:withCCPBVActionPath:withJavaIoInputStream:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "processEntryWithRAREUTJSONObject:withRAREUTJSONWriter:withJavaIoWriter:withRAREUTCharArray:withNSObjectArray:", NULL, "V", 0x84, "JavaIoIOException" },
  };
  static J2ObjcClassInfo _ComSparsewareBellavistaExternalFhirProcedure = { "Procedure", "com.sparseware.bellavista.external.fhir", NULL, 0x1, 3, methods, 0, NULL, 0, NULL};
  return &_ComSparsewareBellavistaExternalFhirProcedure;
}

@end
