//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: com/sparseware/bellavista/Document.java
//
//  Created by decoteaud on 2/17/16.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/appnativa/rare/FunctionCallbackWaiter.h"
#include "com/appnativa/rare/Platform.h"
#include "com/appnativa/rare/iCancelableFuture.h"
#include "com/appnativa/rare/iConstants.h"
#include "com/appnativa/rare/iFunctionCallback.h"
#include "com/appnativa/rare/iPlatformAppContext.h"
#include "com/appnativa/rare/net/ActionLink.h"
#include "com/appnativa/rare/net/iMultipartMimeHandler.h"
#include "com/appnativa/rare/scripting/Functions.h"
#include "com/appnativa/rare/spot/GridPane.h"
#include "com/appnativa/rare/spot/Region.h"
#include "com/appnativa/rare/spot/SplitPane.h"
#include "com/appnativa/rare/ui/RenderableDataItem.h"
#include "com/appnativa/rare/ui/UIImageIcon.h"
#include "com/appnativa/rare/ui/UIScreen.h"
#include "com/appnativa/rare/ui/event/ActionEvent.h"
#include "com/appnativa/rare/ui/event/ChangeEvent.h"
#include "com/appnativa/rare/ui/event/iActionListener.h"
#include "com/appnativa/rare/ui/iPlatformComponent.h"
#include "com/appnativa/rare/ui/iPlatformIcon.h"
#include "com/appnativa/rare/util/DataItemCSVParser.h"
#include "com/appnativa/rare/util/DataItemParserHandler.h"
#include "com/appnativa/rare/viewer/CollapsiblePaneViewer.h"
#include "com/appnativa/rare/viewer/DocumentPaneViewer.h"
#include "com/appnativa/rare/viewer/GridPaneViewer.h"
#include "com/appnativa/rare/viewer/StackPaneViewer.h"
#include "com/appnativa/rare/viewer/TableViewer.h"
#include "com/appnativa/rare/viewer/ToolBarViewer.h"
#include "com/appnativa/rare/viewer/WebBrowser.h"
#include "com/appnativa/rare/viewer/WindowViewer.h"
#include "com/appnativa/rare/viewer/iContainer.h"
#include "com/appnativa/rare/viewer/iFormViewer.h"
#include "com/appnativa/rare/viewer/iTarget.h"
#include "com/appnativa/rare/viewer/iViewer.h"
#include "com/appnativa/rare/widget/iWidget.h"
#include "com/appnativa/spot/SPOTAny.h"
#include "com/appnativa/spot/SPOTBoolean.h"
#include "com/appnativa/spot/SPOTSet.h"
#include "com/appnativa/spot/iSPOTElement.h"
#include "com/appnativa/util/ObjectHolder.h"
#include "com/appnativa/util/StringCache.h"
#include "com/appnativa/util/iCancelable.h"
#include "com/appnativa/util/json/JSONObject.h"
#include "com/sparseware/bellavista/Document.h"
#include "com/sparseware/bellavista/Utils.h"
#include "com/sparseware/bellavista/external/aAttachmentHandler.h"
#include "java/io/StringReader.h"
#include "java/lang/Exception.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/System.h"
#include "java/lang/Throwable.h"
#include "java/net/MalformedURLException.h"
#include "java/net/URL.h"
#include "java/util/ArrayList.h"
#include "java/util/Date.h"
#include "java/util/HashMap.h"
#include "java/util/List.h"
#include "java/util/Locale.h"

@implementation CCPBVDocument

static RARERenderableDataItem * CCPBVDocument__documentItem_;
static NSString * CCPBVDocument_VIEWER_CALLBACK_ID_ = @"viewer";
static NSString * CCPBVDocument_DOCUMENT_CALLBACK_ID_ = @"document";
static NSString * CCPBVDocument_bodyOutOfBandText_;
static RARESPOTGridPane * CCPBVDocument_documentViewerCfg_;

+ (RARERenderableDataItem *)_documentItem {
  return CCPBVDocument__documentItem_;
}

+ (NSString *)VIEWER_CALLBACK_ID {
  return CCPBVDocument_VIEWER_CALLBACK_ID_;
}

+ (void)setVIEWER_CALLBACK_ID:(NSString *)VIEWER_CALLBACK_ID {
  CCPBVDocument_VIEWER_CALLBACK_ID_ = VIEWER_CALLBACK_ID;
}

+ (NSString *)DOCUMENT_CALLBACK_ID {
  return CCPBVDocument_DOCUMENT_CALLBACK_ID_;
}

+ (void)setDOCUMENT_CALLBACK_ID:(NSString *)DOCUMENT_CALLBACK_ID {
  CCPBVDocument_DOCUMENT_CALLBACK_ID_ = DOCUMENT_CALLBACK_ID;
}

+ (NSString *)bodyOutOfBandText {
  return CCPBVDocument_bodyOutOfBandText_;
}

+ (void)setBodyOutOfBandText:(NSString *)bodyOutOfBandText {
  CCPBVDocument_bodyOutOfBandText_ = bodyOutOfBandText;
}

+ (RARESPOTGridPane *)documentViewerCfg {
  return CCPBVDocument_documentViewerCfg_;
}

+ (void)setDocumentViewerCfg:(RARESPOTGridPane *)documentViewerCfg {
  CCPBVDocument_documentViewerCfg_ = documentViewerCfg;
}

- (id)initWithRAREiWidget:(id<RAREiWidget>)widget
       withRAREActionLink:(RAREActionLink *)link
             withNSString:(NSString *)id_ {
  if (self = [super init]) {
    self->documentLink_ = link;
    self->documentID_ = id_;
    contextWidget_Document_ = widget;
  }
  return self;
}

- (void)addAttachmentWithCCPBVDocument_DocumentItemTypeEnum:(CCPBVDocument_DocumentItemTypeEnum *)type
                                           withJavaUtilDate:(JavaUtilDate *)date
                                               withNSString:(NSString *)title
                                               withNSString:(NSString *)href {
  (void) [self addAttachmentWithCCPBVDocument_DocumentItemTypeEnum:type withJavaUtilDate:date withNSString:title withNSString:nil withNSString:nil withNSString:href];
}

- (CCPBVDocument_DocumentItem *)addAttachmentWithCCPBVDocument_DocumentItemTypeEnum:(CCPBVDocument_DocumentItemTypeEnum *)type
                                                                   withJavaUtilDate:(JavaUtilDate *)date
                                                                       withNSString:(NSString *)title
                                                                       withNSString:(NSString *)mimeType
                                                                       withNSString:(NSString *)body
                                                                       withNSString:(NSString *)href {
  RAREWindowViewer *w = [RAREPlatform getWindowViewer];
  RARERenderableDataItem *row = [((RAREWindowViewer *) nil_chk(w)) createRowWithInt:5 withBoolean:YES];
  [((RARERenderableDataItem *) nil_chk([((RARERenderableDataItem *) nil_chk(row)) getWithInt:0])) setValueWithId:[((NSString *) nil_chk([((CCPBVDocument_DocumentItemTypeEnum *) nil_chk(type)) description])) lowercaseStringWithJRELocale:[JavaUtilLocale US]]];
  [((RARERenderableDataItem *) nil_chk([row getWithInt:1])) setValueWithId:title];
  RARERenderableDataItem *item = [row getWithInt:2];
  [((RARERenderableDataItem *) nil_chk(item)) setTypeWithInt:RARERenderableDataItem_TYPE_DATETIME];
  [item setValueWithId:date];
  [((RARERenderableDataItem *) nil_chk([row getWithInt:3])) setValueWithId:@"false"];
  [((RARERenderableDataItem *) nil_chk([row getWithInt:4])) setValueWithId:href];
  CCPBVDocument_DocumentItem *di = [[CCPBVDocument_DocumentItem alloc] initWithNSString:body withNSString:mimeType withCCPBVDocument_DocumentItemTypeEnum:type];
  di->rowData_ = row;
  if (docAttachments_ == nil) {
    docAttachments_ = [[JavaUtilArrayList alloc] initWithInt:5];
  }
  [((id<JavaUtilList>) nil_chk(docAttachments_)) addWithId:di];
  return di;
}

+ (void)staticInitialize {
  CCPBVDocument_documentViewerCfg_ = (RARESPOTGridPane *) check_class_cast([((RAREWindowViewer *) nil_chk([RAREPlatform getWindowViewer])) createConfigurationObjectWithRAREActionLink:[[RAREActionLink alloc] initWithNSString:@"/document_viewer.rml"]], [RARESPOTGridPane class]);
  RAREUTJSONObject *info = (RAREUTJSONObject *) check_class_cast([((id<RAREiPlatformAppContext>) nil_chk([RAREPlatform getAppContext])) getDataWithId:@"notesInfo"], [RAREUTJSONObject class]);
  CCPBVDocument_bodyOutOfBandText_ = [((RAREUTJSONObject *) nil_chk(info)) optStringWithNSString:@"bodyOutOfBandText" withNSString:@""];
  if ([((NSString *) nil_chk(CCPBVDocument_bodyOutOfBandText_)) sequenceLength] == 0) {
    CCPBVDocument_bodyOutOfBandText_ = nil;
  }
}

- (id)compute {
  RAREActionLink *link = documentLink_;
  @try {
    if (![((RAREActionLink *) nil_chk(link)) isMultipartDocument]) {
      NSString *type = [link getContentType];
      NSString *data = [link getContentAsString];
      if ([CCPBVUtils isDemo] && [((NSString *) nil_chk(data)) contains:@"SIRF_MULTIPART_BOUNDARY_PART"]) {
        link = [[RAREActionLink alloc] initWithNSString:data withNSString:@"multipart/mixed; boundary=\"__FF00_SIRF_MULTIPART_BOUNDARY_PART_OOFF__\""];
        [link setContextWithRAREUTiURLResolver:contextWidget_Document_];
      }
      else {
        mainDocument_ = [[CCPBVDocument_DocumentItem alloc] initWithNSString:data withNSString:type withCCPBVDocument_DocumentItemTypeEnum:[CCPBVDocument_DocumentItemTypeEnum DOCUMENT]];
        [self setMainDocumentInfoWithJavaUtilDate:documentDate_ withNSString:documentTitle_];
        return nil;
      }
    }
    id<RAREiMultipartMimeHandler_iMultipart> mp = [link getFirstPart];
    int i = 0;
    NSString *s = [((id<RAREiMultipartMimeHandler_iMultipart>) nil_chk(mp)) getPreamble];
    id<JavaUtilList> items = nil;
    id<JavaUtilList> docs = [[JavaUtilArrayList alloc] initWithInt:5];
    if (s != nil) {
      s = [s trim];
      if ([((NSString *) nil_chk(s)) sequenceLength] != 0) {
        RAREDataItemParserHandler *ph = [[RAREDataItemParserHandler alloc] initWithRAREiWidget:contextWidget_Document_];
        RAREDataItemCSVParser *p = [[RAREDataItemCSVParser alloc] initWithJavaIoReader:[[JavaIoStringReader alloc] initWithNSString:s] withChar:[CCPBVUtils colSeparator] withChar:[CCPBVUtils ldSeparator]];
        [p parseWithRAREiWidget:contextWidget_Document_ withInt:-1 withRAREiDataItemParserCallback:ph];
        items = [ph getListEx];
      }
    }
    RARERenderableDataItem *row;
    int len = (items == nil) ? 0 : [items size];
    while (mp != nil) {
      CCPBVDocument_DocumentItem *doc = [[CCPBVDocument_DocumentItem alloc] init];
      doc->mimeType_ = [mp getContentType];
      doc->itemBody_ = [mp getContentAsString];
      if (i < len) {
        row = [((id<JavaUtilList>) nil_chk(items)) getWithInt:i++];
        if ((CCPBVDocument_bodyOutOfBandText_ != nil) && [((NSString *) nil_chk(doc->itemBody_)) hasPrefix:CCPBVDocument_bodyOutOfBandText_]) {
          doc->itemBody_ = nil;
        }
        doc = [self processDocumentRowWithCCPBVDocument_DocumentItem:doc withRARERenderableDataItem:row];
      }
      if ((doc != nil) && (mainDocument_ != doc)) {
        [docs addWithId:doc];
      }
      mp = [mp nextPart];
    }
    while (i < len) {
      CCPBVDocument_DocumentItem *doc = [[CCPBVDocument_DocumentItem alloc] init];
      row = [((id<JavaUtilList>) nil_chk(items)) getWithInt:i++];
      (void) [self processDocumentRowWithCCPBVDocument_DocumentItem:doc withRARERenderableDataItem:row];
      [docs addWithId:doc];
    }
    if ((mainDocument_ == nil) && ([docs size] > 0)) {
      mainDocument_ = [docs removeWithInt:0];
    }
    if (((CCPBVDocument_DocumentItem *) nil_chk(mainDocument_))->rowData_ == nil) {
      [self setMainDocumentInfoWithJavaUtilDate:documentDate_ withNSString:documentTitle_];
    }
    else {
      if (documentTitle_ != nil) {
        [((RARERenderableDataItem *) nil_chk([mainDocument_->rowData_ getWithInt:1])) setValueWithId:documentTitle_];
      }
      if (documentDate_ != nil) {
        [((RARERenderableDataItem *) nil_chk([mainDocument_->rowData_ getWithInt:2])) setValueWithId:documentDate_];
      }
    }
    if (docAttachments_ != nil) {
      [docAttachments_ addAllWithInt:0 withJavaUtilCollection:docs];
    }
    else {
      docAttachments_ = docs;
    }
  }
  @catch (JavaLangException *e) {
    return e;
  }
  @finally {
    [((RAREActionLink *) nil_chk(link)) close];
    if (link != documentLink_) {
      [((RAREActionLink *) nil_chk(documentLink_)) close];
    }
  }
  return nil;
}

- (void)dispose {
  if (mainDocument_ != nil) {
    [mainDocument_ dispose];
  }
  if (docAttachments_ != nil) {
    for (CCPBVDocument_DocumentItem * __strong d in docAttachments_) {
      [((CCPBVDocument_DocumentItem *) nil_chk(d)) dispose];
    }
    [docAttachments_ clear];
  }
  if (documentLink_ != nil) {
    [documentLink_ clear];
  }
  contextWidget_Document_ = nil;
  mainDocument_ = nil;
  docAttachments_ = nil;
  documentLink_ = nil;
  callback_Document_ = nil;
  window_ = nil;
  linkedData_ = nil;
}

- (void)finishWithId:(id)result {
  if (callback_Document_ != nil) {
    [callback_Document_ finishedWithBoolean:result != nil withId:(result == nil) ? self : result];
    callback_Document_ = nil;
  }
}

- (CCPBVDocument_DocumentItem *)getAttachmentWithInt:(int)index {
  return [((id<JavaUtilList>) nil_chk(docAttachments_)) getWithInt:index];
}

- (int)getAttachmentCount {
  return (docAttachments_ == nil) ? 0 : [docAttachments_ size];
}

- (NSString *)getID {
  return documentID_;
}

- (void)load__WithRAREiFunctionCallback:(id<RAREiFunctionCallback>)cb {
  self->callback_Document_ = cb;
  (void) [((RAREWindowViewer *) nil_chk([RAREPlatform getWindowViewer])) spawnWithNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ self } count:1 type:[IOSClass classWithClass:[NSObject class]]]];
}

- (void)loadAndPopulateViewerWithRAREActionLink:(RAREActionLink *)viewerLink {
  RAREWindowViewer *w = [RAREPlatform getWindowViewer];
  RAREFunctionCallbackWaiter *waiter = [[RAREFunctionCallbackWaiter alloc] init];
  (void) [((RAREWindowViewer *) nil_chk(w)) createViewerWithRAREActionLink:viewerLink withRAREiFunctionCallback:[waiter createCallbackWithId:CCPBVDocument_VIEWER_CALLBACK_ID_]];
  [self load__WithRAREiFunctionCallback:[waiter createCallbackWithId:CCPBVDocument_DOCUMENT_CALLBACK_ID_]];
  id<RAREiFunctionCallback> cb = [[CCPBVDocument_$1 alloc] initWithCCPBVDocument:self withRAREActionLink:viewerLink withRAREWindowViewer:w];
  [w showWaitCursor];
  [waiter startWaitingWithRAREiFunctionCallback:cb];
}

- (void)loadAndPopulateViewerWithRAREiContainer:(id<RAREiContainer>)fv {
  RAREWindowViewer *w = [RAREPlatform getWindowViewer];
  id<RAREiFunctionCallback> cb = [[CCPBVDocument_$2 alloc] initWithCCPBVDocument:self withRAREWindowViewer:w withRAREiContainer:fv];
  [((RAREWindowViewer *) nil_chk(w)) showWaitCursor];
  [self load__WithRAREiFunctionCallback:cb];
}

- (void)populateViewerWithRAREiContainer:(id<RAREiContainer>)fv {
  [((id<RAREiContainer>) nil_chk(fv)) setLinkedDataWithId:self];
  [self populateViewerWithRAREiContainer:fv withCCPBVDocument_DocumentItem:mainDocument_];
  RAREWindowViewer *w = [RAREPlatform getWindowViewer];
  RARECollapsiblePaneViewer *cpv = (RARECollapsiblePaneViewer *) check_class_cast([fv getWidgetWithNSString:@"attachments"], [RARECollapsiblePaneViewer class]);
  if (cpv != nil) {
    RARETableViewer *table = (RARETableViewer *) check_class_cast([cpv getWidget], [RARETableViewer class]);
    [((RARETableViewer *) nil_chk(table)) clear];
    if ([table getActionListener] == nil) {
      id<RAREiActionListener> al = [[CCPBVDocument_AttachmentActionListener alloc] init];
      [table setActionListenerWithRAREiActionListener:al];
    }
    int len = [self getAttachmentCount];
    [((id<RAREiTarget>) nil_chk([cpv getTarget])) setVisibleWithBoolean:len > 0];
    if (len > 0) {
      [cpv setTitleTextWithJavaLangCharSequence:[((RAREWindowViewer *) nil_chk(w)) getStringWithNSString:@"bv.format.attachments_spec" withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ [RAREUTStringCache valueOfWithInt:len] } count:1 type:[IOSClass classWithClass:[NSObject class]]]]];
      [((RARERenderableDataItem *) nil_chk([((RARERenderableDataItem *) nil_chk(((CCPBVDocument_DocumentItem *) nil_chk(mainDocument_))->rowData_)) getWithInt:1])) setValueWithId:[w getStringWithNSString:@"bv.text.master_document"]];
      BOOL hasDate = NO;
      for (int i = 0; i < len; i++) {
        CCPBVDocument_DocumentItem *item = [((id<JavaUtilList>) nil_chk(docAttachments_)) getWithInt:i];
        if (((CCPBVDocument_DocumentItem *) nil_chk(item))->rowData_ != nil) {
          [table addExWithRARERenderableDataItem:item->rowData_];
          if ([item hasDate]) {
            hasDate = YES;
          }
        }
      }
      if ([RAREUIScreen isMediumDensity]) {
        [table addExWithRARERenderableDataItem:mainDocument_->rowData_];
      }
      [table setColumnVisibleWithInt:2 withBoolean:hasDate];
      [table refreshItems];
      if (hasDate) {
        [table sortWithInt:2 withBoolean:YES];
      }
    }
  }
}

- (void)populateViewerWithRAREiContainer:(id<RAREiContainer>)fv
          withCCPBVDocument_DocumentItem:(CCPBVDocument_DocumentItem *)doc {
  @try {
    RARERenderableDataItem *row = ((CCPBVDocument_DocumentItem *) nil_chk(doc))->rowData_;
    id<RAREiWidget> field;
    field = [((id<RAREiContainer>) nil_chk(fv)) getWidgetWithNSString:@"documentDate"];
    NSString *s;
    if (field != nil) {
      s = (row == nil) ? @"" : [RAREFunctions convertDateTimeWithId:[((RARERenderableDataItem *) nil_chk([row getWithInt:2])) getValue]];
      [field setValueWithId:s];
    }
    field = [fv getWidgetWithNSString:@"documentTitle"];
    if (field != nil) {
      s = doc->itemTitle_;
      if ((s == nil) && (row != nil)) {
        s = [((RARERenderableDataItem *) nil_chk([row getWithInt:1])) description];
      }
      [field setValueWithId:(s == nil) ? @"" : s];
    }
    field = [fv getWidgetWithNSString:@"extraHeaderDetail"];
    if (field != nil) {
      s = @"";
      if ((row != nil) && ([row size] > 4)) {
        s = [field getValueAsString];
        if ((s != nil) && ([s sequenceLength] != 0)) {
          NSString *title = (NSString *) check_class_cast([((RARERenderableDataItem *) nil_chk([row getWithInt:4])) getValue], [NSString class]);
          s = [NSString formatWithNSString:s withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ title } count:1 type:[IOSClass classWithClass:[NSObject class]]]];
        }
        else {
          s = (NSString *) check_class_cast([((RARERenderableDataItem *) nil_chk([row getWithInt:4])) getValue], [NSString class]);
        }
      }
      [field setValueWithId:s];
    }
    id<RAREiViewer> v = (id<RAREiViewer>) check_protocol_cast([fv getWidgetWithNSString:@"documentDetail"], @protocol(RAREiViewer));
    if (v != nil) {
      BOOL html = NO;
      if ((doc->mimeType_ != nil) && [doc->mimeType_ hasPrefix:[RAREiConstants HTML_MIME_TYPE]]) {
        html = YES;
      }
      if ([(id) v isKindOfClass:[RAREDocumentPaneViewer class]]) {
        [((RAREDocumentPaneViewer *) check_class_cast(v, [RAREDocumentPaneViewer class])) setTextWithNSString:doc->itemBody_ withBoolean:html];
      }
      else if ([(id) v isKindOfClass:[RAREWebBrowser class]]) {
        s = doc->itemBody_;
        if (!html) {
          s = [NSString stringWithFormat:@"<html><body><pre style=\"white-space: pre-wrap; margin:0; padding:0\">%@</pre></body></html>", s];
        }
        NSString *href = nil;
        RAREWebBrowser *browser = (RAREWebBrowser *) check_class_cast(v, [RAREWebBrowser class]);
        if ([v getWidth] < 50) {
          NSString *data = s;
          NSString *url = href;
          [((id<RAREiPlatformComponent>) nil_chk([browser getContainerComponent])) addViewListenerWithRAREiViewListener:[[CCPBVDocument_$3 alloc] initWithRAREWebBrowser:browser withNSString:url withNSString:data]];
        }
        else {
          [browser setHTMLWithNSString:href withNSString:s];
        }
      }
      else {
        [v setValueWithId:doc->itemBody_];
      }
    }
  }
  @catch (JavaLangException *e) {
    [CCPBVUtils handleErrorWithJavaLangThrowable:e];
  }
}

- (void)setMainDocumentWithNSString:(NSString *)body
                       withNSString:(NSString *)type
                   withJavaUtilDate:(JavaUtilDate *)date
                       withNSString:(NSString *)title {
  mainDocument_ = [[CCPBVDocument_DocumentItem alloc] initWithNSString:body withNSString:type withCCPBVDocument_DocumentItemTypeEnum:[CCPBVDocument_DocumentItemTypeEnum DOCUMENT]];
  [self setMainDocumentInfoWithJavaUtilDate:date withNSString:title];
}

- (void)setMainDocumentInfoWithJavaUtilDate:(JavaUtilDate *)date
                               withNSString:(NSString *)title {
  if (mainDocument_ != nil) {
    RARERenderableDataItem *row = [[RARERenderableDataItem alloc] init];
    [row addWithId:CCPBVDocument__documentItem_];
    [row addWithId:[[RARERenderableDataItem alloc] initWithId:title]];
    [row addWithId:[[RARERenderableDataItem alloc] initWithId:date]];
    mainDocument_->rowData_ = row;
  }
  else {
    documentTitle_ = title;
    documentDate_ = date;
  }
}

- (CCPBVDocument_DocumentItem *)processDocumentRowWithCCPBVDocument_DocumentItem:(CCPBVDocument_DocumentItem *)doc
                                                      withRARERenderableDataItem:(RARERenderableDataItem *)row {
  if ([((RARERenderableDataItem *) nil_chk(row)) size] > 3) {
    CCPBVDocument_DocumentItemTypeEnum *type = [CCPBVDocument_DocumentItemTypeEnum DOCUMENT];
    @try {
      NSString *s = [((RARERenderableDataItem *) nil_chk([row getWithInt:0])) description];
      NSString *custom = nil;
      int n = [((NSString *) nil_chk(s)) indexOf:':'];
      if (n != -1) {
        custom = [s substring:n + 1];
        s = [s substring:0 endIndex:n];
      }
      s = [((NSString *) nil_chk(s)) uppercaseStringWithJRELocale:[JavaUtilLocale US]];
      type = [CCPBVDocument_DocumentItemTypeEnum valueOfWithNSString:s];
      if (type == [CCPBVDocument_DocumentItemTypeEnum CUSTOM]) {
        ((CCPBVDocument_DocumentItem *) nil_chk(doc))->customItemType_ = custom;
      }
    }
    @catch (JavaLangException *e) {
      [RAREPlatform ignoreExceptionWithNSString:nil withJavaLangThrowable:e];
    }
    ((CCPBVDocument_DocumentItem *) nil_chk(doc))->itemType_ = type;
    RARERenderableDataItem *item0 = [row getWithInt:0];
    switch ([type ordinal]) {
      case CCPBVDocument_DocumentItemType_DOCUMENT:
      if ([@"true" isEqual:[((RARERenderableDataItem *) nil_chk([row getWithInt:3])) getValue]]) {
        mainDocument_ = doc;
      }
      break;
      case CCPBVDocument_DocumentItemType_IMAGE:
      if ([((RARERenderableDataItem *) nil_chk(item0)) getIcon] == nil) {
        [item0 setIconWithRAREiPlatformIcon:[((id<RAREiPlatformAppContext>) nil_chk([RAREPlatform getAppContext])) getResourceAsIconWithNSString:@"bv.icon.camera"]];
      }
      break;
      case CCPBVDocument_DocumentItemType_IMAGE_SLIDES:
      if ([((RARERenderableDataItem *) nil_chk(item0)) getIcon] == nil) {
        [item0 setIconWithRAREiPlatformIcon:[((id<RAREiPlatformAppContext>) nil_chk([RAREPlatform getAppContext])) getResourceAsIconWithNSString:@"bv.icon.xray"]];
      }
      break;
      default:
      break;
    }
    [((RARERenderableDataItem *) nil_chk([row getWithInt:2])) setTypeWithInt:RARERenderableDataItem_TYPE_DATETIME];
  }
  ((CCPBVDocument_DocumentItem *) nil_chk(doc))->rowData_ = row;
  return doc;
}

+ (RAREGridPaneViewer *)createDocumentViewerWithRAREiContainer:(id<RAREiContainer>)parent
                                                   withBoolean:(BOOL)hasAttachments {
  RARESPOTRegion *r = (RARESPOTRegion *) check_class_cast([((RARESPOTGridPane *) nil_chk(CCPBVDocument_documentViewerCfg_))->regions_ getExWithInt:[((SPOTSet *) nil_chk(CCPBVDocument_documentViewerCfg_->regions_)) size] - 1], [RARESPOTRegion class]);
  r = (RARESPOTRegion *) check_class_cast([((SPOTSet *) nil_chk(((RARESPOTSplitPane *) nil_chk([((SPOTAny *) nil_chk(((RARESPOTRegion *) nil_chk(r))->viewer_)) getValue]))->regions_)) getExWithInt:[CCPBVDocument_documentViewerCfg_->regions_ size] - 1], [RARESPOTRegion class]);
  [((SPOTBoolean *) nil_chk(((RARESPOTRegion *) nil_chk(r))->visible_)) setValueWithBoolean:hasAttachments];
  return (RAREGridPaneViewer *) check_class_cast([((RAREWindowViewer *) nil_chk([RAREPlatform getWindowViewer])) createViewerWithRAREiWidget:parent withRARESPOTWidget:CCPBVDocument_documentViewerCfg_], [RAREGridPaneViewer class]);
}

- (id)getLinkedData {
  return linkedData_;
}

- (void)setLinkedDataWithId:(id)linkedData {
  self->linkedData_ = linkedData;
}

+ (void)initialize {
  if (self == [CCPBVDocument class]) {
    CCPBVDocument__documentItem_ = [[RARERenderableDataItem alloc] initWithId:@"document"];
  }
}

- (void)copyAllFieldsTo:(CCPBVDocument *)other {
  [super copyAllFieldsTo:other];
  other->callback_Document_ = callback_Document_;
  other->contextWidget_Document_ = contextWidget_Document_;
  other->docAttachments_ = docAttachments_;
  other->documentDate_ = documentDate_;
  other->documentID_ = documentID_;
  other->documentLink_ = documentLink_;
  other->documentTitle_ = documentTitle_;
  other->linkedData_ = linkedData_;
  other->mainDocument_ = mainDocument_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "addAttachmentWithCCPBVDocument_DocumentItemTypeEnum:withJavaUtilDate:withNSString:withNSString:withNSString:withNSString:", NULL, "LCCPBVDocument_DocumentItem", 0x1, NULL },
    { "staticInitialize", NULL, "V", 0x8, "JavaLangException" },
    { "compute", NULL, "LNSObject", 0x1, NULL },
    { "getAttachmentWithInt:", NULL, "LCCPBVDocument_DocumentItem", 0x1, NULL },
    { "getID", NULL, "LNSString", 0x1, NULL },
    { "loadAndPopulateViewerWithRAREActionLink:", NULL, "V", 0x1, "JavaLangException" },
    { "processDocumentRowWithCCPBVDocument_DocumentItem:withRARERenderableDataItem:", NULL, "LCCPBVDocument_DocumentItem", 0x4, NULL },
    { "createDocumentViewerWithRAREiContainer:withBoolean:", NULL, "LRAREGridPaneViewer", 0x9, NULL },
    { "getLinkedData", NULL, "LNSObject", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "documentID_", NULL, 0x4, "LNSString" },
    { "documentLink_", NULL, 0x4, "LRAREActionLink" },
    { "docAttachments_", NULL, 0x4, "LJavaUtilList" },
    { "mainDocument_", NULL, 0x4, "LCCPBVDocument_DocumentItem" },
    { "contextWidget_Document_", "contextWidget", 0x4, "LRAREiWidget" },
    { "callback_Document_", "callback", 0x4, "LRAREiFunctionCallback" },
    { "_documentItem_", NULL, 0x1a, "LRARERenderableDataItem" },
    { "VIEWER_CALLBACK_ID_", NULL, 0xa, "LNSString" },
    { "DOCUMENT_CALLBACK_ID_", NULL, 0xa, "LNSString" },
    { "documentDate_", NULL, 0x0, "LJavaUtilDate" },
    { "documentTitle_", NULL, 0x0, "LNSString" },
    { "bodyOutOfBandText_", NULL, 0x8, "LNSString" },
    { "documentViewerCfg_", NULL, 0x8, "LRARESPOTGridPane" },
  };
  static J2ObjcClassInfo _CCPBVDocument = { "Document", "com.sparseware.bellavista", NULL, 0x1, 9, methods, 13, fields, 0, NULL};
  return &_CCPBVDocument;
}

@end
@implementation CCPBVDocument_DocumentItem

- (id)init {
  if (self = [super init]) {
    itemType_ = [CCPBVDocument_DocumentItemTypeEnum DOCUMENT];
  }
  return self;
}

- (id)initWithNSString:(NSString *)body
          withNSString:(NSString *)mimeType
withCCPBVDocument_DocumentItemTypeEnum:(CCPBVDocument_DocumentItemTypeEnum *)itemType {
  if (self = [super init]) {
    itemType_ = [CCPBVDocument_DocumentItemTypeEnum DOCUMENT];
    self->itemBody_ = body;
    self->mimeType_ = mimeType;
    self->itemType_ = itemType;
  }
  return self;
}

- (void)dispose {
  if (handler_ != nil) {
    [handler_ dispose];
  }
  if (rowData_ != nil) {
    [rowData_ clear];
  }
  handler_ = nil;
  rowData_ = nil;
}

- (JavaUtilDate *)getDate {
  if (rowData_ != nil) {
    return (JavaUtilDate *) check_class_cast([((RARERenderableDataItem *) nil_chk([rowData_ getWithInt:2])) getValue], [JavaUtilDate class]);
  }
  return nil;
}

- (NSString *)getHREF {
  if (rowData_ != nil) {
    RARERenderableDataItem *item = [rowData_ getItemExWithInt:4];
    if (item != nil) {
      return [item description];
    }
  }
  return nil;
}

- (NSString *)getDateString {
  if (rowData_ != nil) {
    return [((RARERenderableDataItem *) nil_chk([rowData_ getWithInt:2])) description];
  }
  return nil;
}

- (CCPBVaAttachmentHandler *)getHandler {
  if (handler_ == nil) {
    NSString *type = itemType_ == [CCPBVDocument_DocumentItemTypeEnum CUSTOM] ? customItemType_ : [((CCPBVDocument_DocumentItemTypeEnum *) nil_chk(itemType_)) name];
    handler_ = [CCPBVUtils getAttachmentHandlerWithNSString:type];
  }
  return handler_;
}

- (NSString *)getTitle {
  if (itemTitle_ == nil) {
    if (rowData_ != nil) {
      itemTitle_ = [((RARERenderableDataItem *) nil_chk([rowData_ getWithInt:1])) description];
    }
    else {
      itemTitle_ = @"";
    }
  }
  return itemTitle_;
}

- (BOOL)hasDate {
  RARERenderableDataItem *item = [((RARERenderableDataItem *) nil_chk(rowData_)) getItemExWithInt:2];
  return (item != nil) && ([item getValue] != nil);
}

- (NSString *)description {
  return itemBody_;
}

- (CCPBVDocument_DocumentItemTypeEnum *)getItemType {
  return itemType_;
}

- (void)copyAllFieldsTo:(CCPBVDocument_DocumentItem *)other {
  [super copyAllFieldsTo:other];
  other->customItemType_ = customItemType_;
  other->handler_ = handler_;
  other->itemBody_ = itemBody_;
  other->itemTitle_ = itemTitle_;
  other->itemType_ = itemType_;
  other->mimeType_ = mimeType_;
  other->rowData_ = rowData_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "getDate", NULL, "LJavaUtilDate", 0x1, NULL },
    { "getHREF", NULL, "LNSString", 0x1, NULL },
    { "getDateString", NULL, "LNSString", 0x1, NULL },
    { "getHandler", NULL, "LCCPBVaAttachmentHandler", 0x1, NULL },
    { "getTitle", NULL, "LNSString", 0x1, NULL },
    { "hasDate", NULL, "Z", 0x1, NULL },
    { "getItemType", NULL, "LCCPBVDocument_DocumentItemTypeEnum", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "itemType_", NULL, 0x1, "LCCPBVDocument_DocumentItemTypeEnum" },
    { "itemBody_", NULL, 0x1, "LNSString" },
    { "mimeType_", NULL, 0x1, "LNSString" },
    { "rowData_", NULL, 0x1, "LRARERenderableDataItem" },
    { "itemTitle_", NULL, 0x1, "LNSString" },
    { "customItemType_", NULL, 0x1, "LNSString" },
    { "handler_", NULL, 0x1, "LCCPBVaAttachmentHandler" },
  };
  static J2ObjcClassInfo _CCPBVDocument_DocumentItem = { "DocumentItem", "com.sparseware.bellavista", "Document", 0x9, 7, methods, 7, fields, 0, NULL};
  return &_CCPBVDocument_DocumentItem;
}

@end

static CCPBVDocument_DocumentItemTypeEnum *CCPBVDocument_DocumentItemTypeEnum_DOCUMENT;
static CCPBVDocument_DocumentItemTypeEnum *CCPBVDocument_DocumentItemTypeEnum_IMAGE;
static CCPBVDocument_DocumentItemTypeEnum *CCPBVDocument_DocumentItemTypeEnum_IMAGE_SLIDES;
static CCPBVDocument_DocumentItemTypeEnum *CCPBVDocument_DocumentItemTypeEnum_AUDIO;
static CCPBVDocument_DocumentItemTypeEnum *CCPBVDocument_DocumentItemTypeEnum_VIDEO;
static CCPBVDocument_DocumentItemTypeEnum *CCPBVDocument_DocumentItemTypeEnum_CUSTOM;
IOSObjectArray *CCPBVDocument_DocumentItemTypeEnum_values;

@implementation CCPBVDocument_DocumentItemTypeEnum

+ (CCPBVDocument_DocumentItemTypeEnum *)DOCUMENT {
  return CCPBVDocument_DocumentItemTypeEnum_DOCUMENT;
}
+ (CCPBVDocument_DocumentItemTypeEnum *)IMAGE {
  return CCPBVDocument_DocumentItemTypeEnum_IMAGE;
}
+ (CCPBVDocument_DocumentItemTypeEnum *)IMAGE_SLIDES {
  return CCPBVDocument_DocumentItemTypeEnum_IMAGE_SLIDES;
}
+ (CCPBVDocument_DocumentItemTypeEnum *)AUDIO {
  return CCPBVDocument_DocumentItemTypeEnum_AUDIO;
}
+ (CCPBVDocument_DocumentItemTypeEnum *)VIDEO {
  return CCPBVDocument_DocumentItemTypeEnum_VIDEO;
}
+ (CCPBVDocument_DocumentItemTypeEnum *)CUSTOM {
  return CCPBVDocument_DocumentItemTypeEnum_CUSTOM;
}

- (id)copyWithZone:(NSZone *)zone {
  return self;
}

- (id)initWithNSString:(NSString *)__name withInt:(int)__ordinal {
  return [super initWithNSString:__name withInt:__ordinal];
}

+ (void)initialize {
  if (self == [CCPBVDocument_DocumentItemTypeEnum class]) {
    CCPBVDocument_DocumentItemTypeEnum_DOCUMENT = [[CCPBVDocument_DocumentItemTypeEnum alloc] initWithNSString:@"DOCUMENT" withInt:0];
    CCPBVDocument_DocumentItemTypeEnum_IMAGE = [[CCPBVDocument_DocumentItemTypeEnum alloc] initWithNSString:@"IMAGE" withInt:1];
    CCPBVDocument_DocumentItemTypeEnum_IMAGE_SLIDES = [[CCPBVDocument_DocumentItemTypeEnum alloc] initWithNSString:@"IMAGE_SLIDES" withInt:2];
    CCPBVDocument_DocumentItemTypeEnum_AUDIO = [[CCPBVDocument_DocumentItemTypeEnum alloc] initWithNSString:@"AUDIO" withInt:3];
    CCPBVDocument_DocumentItemTypeEnum_VIDEO = [[CCPBVDocument_DocumentItemTypeEnum alloc] initWithNSString:@"VIDEO" withInt:4];
    CCPBVDocument_DocumentItemTypeEnum_CUSTOM = [[CCPBVDocument_DocumentItemTypeEnum alloc] initWithNSString:@"CUSTOM" withInt:5];
    CCPBVDocument_DocumentItemTypeEnum_values = [[IOSObjectArray alloc] initWithObjects:(id[]){ CCPBVDocument_DocumentItemTypeEnum_DOCUMENT, CCPBVDocument_DocumentItemTypeEnum_IMAGE, CCPBVDocument_DocumentItemTypeEnum_IMAGE_SLIDES, CCPBVDocument_DocumentItemTypeEnum_AUDIO, CCPBVDocument_DocumentItemTypeEnum_VIDEO, CCPBVDocument_DocumentItemTypeEnum_CUSTOM, nil } count:6 type:[IOSClass classWithClass:[CCPBVDocument_DocumentItemTypeEnum class]]];
  }
}

+ (IOSObjectArray *)values {
  return [IOSObjectArray arrayWithArray:CCPBVDocument_DocumentItemTypeEnum_values];
}

+ (CCPBVDocument_DocumentItemTypeEnum *)valueOfWithNSString:(NSString *)name {
  for (int i = 0; i < [CCPBVDocument_DocumentItemTypeEnum_values count]; i++) {
    CCPBVDocument_DocumentItemTypeEnum *e = CCPBVDocument_DocumentItemTypeEnum_values->buffer_[i];
    if ([name isEqual:[e name]]) {
      return e;
    }
  }
  @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:name];
  return nil;
}

+ (J2ObjcClassInfo *)__metadata {
  static const char *superclass_type_args[] = {"LCCPBVDocument_DocumentItemTypeEnum"};
  static J2ObjcClassInfo _CCPBVDocument_DocumentItemTypeEnum = { "DocumentItemType", "com.sparseware.bellavista", "Document", 0x4019, 0, NULL, 0, NULL, 1, superclass_type_args};
  return &_CCPBVDocument_DocumentItemTypeEnum;
}

@end
@implementation CCPBVDocument_AttachmentActionListener

- (void)actionPerformedWithRAREActionEvent:(RAREActionEvent *)e {
  long long int time = [JavaLangSystem currentTimeMillis];
  if (lastActionTime_ + 500 < time) {
    lastActionTime_ = time;
    RAREWindowViewer *w = [RAREPlatform getWindowViewer];
    RARETableViewer *table = (RARETableViewer *) check_class_cast([((RAREActionEvent *) nil_chk(e)) getWidget], [RARETableViewer class]);
    id<RAREiFormViewer> fv = [((RARETableViewer *) nil_chk(table)) getFormViewer];
    CCPBVDocument *doc = (CCPBVDocument *) check_class_cast([((id<RAREiFormViewer>) nil_chk(fv)) getLinkedData], [CCPBVDocument class]);
    int n = [table getSelectedIndex];
    CCPBVDocument_DocumentItem *item = [((CCPBVDocument *) nil_chk(doc)) getAttachmentWithInt:n];
    {
      CCPBVaAttachmentHandler *handler;
      switch ([((CCPBVDocument_DocumentItem *) nil_chk(item))->itemType_ ordinal]) {
        case CCPBVDocument_DocumentItemType_DOCUMENT:
        if (item->itemBody_ == nil) {
          [self handleOutOfBandAttachmentWithCCPBVDocument:doc withRAREiFormViewer:fv withCCPBVDocument_DocumentItem:item];
        }
        else {
          [doc populateViewerWithRAREiContainer:fv withCCPBVDocument_DocumentItem:item];
        }
        break;
        default:
        handler = [item getHandler];
        if (handler == nil) {
          [w alertWithId:[((RAREWindowViewer *) nil_chk(w)) getStringWithNSString:@"bv.text.cant_view_attachment"]];
        }
        else {
          [((RAREWindowViewer *) nil_chk(w)) showWaitCursor];
          RAREStackPaneViewer *sp = (RAREStackPaneViewer *) check_class_cast([CCPBVUtils getStackPaneViewerWithRAREiWidget:fv], [RAREStackPaneViewer class]);
          RAREGridPaneViewer *gp = [CCPBVUtils createGenericContainerViewerWithRAREiContainer:sp];
          n = [((RAREStackPaneViewer *) nil_chk(sp)) addViewerWithNSString:nil withRAREiViewer:gp];
          [sp switchToWithInt:n];
          [handler createViewerWithRAREiContainer:gp withCCPBVDocument:doc withCCPBVDocument_DocumentItem:item withRAREiFunctionCallback:[[CCPBVDocument_AttachmentCallback alloc] initWithRAREGridPaneViewer:gp]];
        }
        break;
      }
    }
  }
}

- (void)handleOutOfBandAttachmentWithCCPBVDocument:(CCPBVDocument *)doc
                               withRAREiFormViewer:(id<RAREiFormViewer>)fv
                    withCCPBVDocument_DocumentItem:(CCPBVDocument_DocumentItem *)item {
  RAREWindowViewer *w = [RAREPlatform getWindowViewer];
  NSString *href = [((CCPBVDocument_DocumentItem *) nil_chk(item)) getHREF];
  @try {
    NSString *id_ = href;
    int n = [((NSString *) nil_chk(href)) lastIndexOf:'/'];
    if (n != -1) {
      id_ = [href substring:n + 1];
    }
    n = [((NSString *) nil_chk(id_)) lastIndexOf:'.'];
    if (n == -1) {
      href = [NSString stringWithFormat:@"%@.html", href];
    }
    else {
      id_ = [id_ substring:0 endIndex:n];
    }
    RAREActionLink *link = [[RAREActionLink alloc] initWithJavaNetURL:[((id<RAREiFormViewer>) nil_chk(fv)) getURLWithNSString:href]];
    CCPBVDocument *ndoc = [[CCPBVDocument alloc] initWithRAREiWidget:fv withRAREActionLink:link withNSString:id_];
    [ndoc load__WithRAREiFunctionCallback:[[CCPBVDocument_AttachmentActionListener_$1 alloc] initWithRAREWindowViewer:w withRAREiFormViewer:fv withCCPBVDocument:ndoc withCCPBVDocument_DocumentItem:item withCCPBVDocument:doc]];
    [((RAREWindowViewer *) nil_chk(w)) showWaitCursor];
  }
  @catch (JavaNetMalformedURLException *e) {
    [CCPBVUtils handleErrorWithJavaLangThrowable:e];
  }
}

- (id)init {
  return [super init];
}

- (void)copyAllFieldsTo:(CCPBVDocument_AttachmentActionListener *)other {
  [super copyAllFieldsTo:other];
  other->lastActionTime_ = lastActionTime_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "handleOutOfBandAttachmentWithCCPBVDocument:withRAREiFormViewer:withCCPBVDocument_DocumentItem:", NULL, "V", 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "lastActionTime_", NULL, 0x0, "J" },
  };
  static J2ObjcClassInfo _CCPBVDocument_AttachmentActionListener = { "AttachmentActionListener", "com.sparseware.bellavista", "Document", 0x8, 1, methods, 1, fields, 0, NULL};
  return &_CCPBVDocument_AttachmentActionListener;
}

@end
@implementation CCPBVDocument_AttachmentActionListener_$1

- (void)finishedWithBoolean:(BOOL)canceled
                     withId:(id)returnValue {
  [((RAREWindowViewer *) nil_chk(val$w_)) hideWaitCursor];
  if ([returnValue isKindOfClass:[JavaLangThrowable class]]) {
    [CCPBVUtils handleErrorWithJavaLangThrowable:(JavaLangThrowable *) check_class_cast(returnValue, [JavaLangThrowable class])];
    return;
  }
  else if (canceled || [((id<RAREiFormViewer>) nil_chk(val$fv_)) isDisposed]) {
    return;
  }
  ((CCPBVDocument_DocumentItem *) nil_chk(((CCPBVDocument *) nil_chk(val$ndoc_))->mainDocument_))->rowData_ = ((CCPBVDocument_DocumentItem *) nil_chk(val$item_))->rowData_;
  if ([val$ndoc_ getAttachmentCount] == 0) {
    [((CCPBVDocument *) nil_chk(val$doc_)) populateViewerWithRAREiContainer:val$fv_ withCCPBVDocument_DocumentItem:val$ndoc_->mainDocument_];
  }
  else {
    RAREStackPaneViewer *sp = [CCPBVUtils getStackPaneViewerWithRAREiWidget:val$fv_];
    RAREGridPaneViewer *gp = [CCPBVDocument createDocumentViewerWithRAREiContainer:sp withBoolean:YES];
    id<RAREiWidget> field = [((RAREGridPaneViewer *) nil_chk(gp)) getWidgetWithNSString:@"backButton"];
    if (field != nil) {
      [field setVisibleWithBoolean:YES];
    }
    int pos = [((RAREStackPaneViewer *) nil_chk(sp)) addViewerWithNSString:nil withRAREiViewer:gp];
    [val$ndoc_ populateViewerWithRAREiContainer:gp];
    [sp switchToWithInt:pos];
  }
}

- (id)initWithRAREWindowViewer:(RAREWindowViewer *)capture$0
           withRAREiFormViewer:(id<RAREiFormViewer>)capture$1
             withCCPBVDocument:(CCPBVDocument *)capture$2
withCCPBVDocument_DocumentItem:(CCPBVDocument_DocumentItem *)capture$3
             withCCPBVDocument:(CCPBVDocument *)capture$4 {
  val$w_ = capture$0;
  val$fv_ = capture$1;
  val$ndoc_ = capture$2;
  val$item_ = capture$3;
  val$doc_ = capture$4;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcFieldInfo fields[] = {
    { "val$w_", NULL, 0x1012, "LRAREWindowViewer" },
    { "val$fv_", NULL, 0x1012, "LRAREiFormViewer" },
    { "val$ndoc_", NULL, 0x1012, "LCCPBVDocument" },
    { "val$item_", NULL, 0x1012, "LCCPBVDocument_DocumentItem" },
    { "val$doc_", NULL, 0x1012, "LCCPBVDocument" },
  };
  static J2ObjcClassInfo _CCPBVDocument_AttachmentActionListener_$1 = { "$1", "com.sparseware.bellavista", "Document$AttachmentActionListener", 0x8000, 0, NULL, 5, fields, 0, NULL};
  return &_CCPBVDocument_AttachmentActionListener_$1;
}

@end
@implementation CCPBVDocument_AttachmentCallback

- (id)initWithRAREGridPaneViewer:(RAREGridPaneViewer *)gp {
  if (self = [super init]) {
    gridPane_ = gp;
  }
  return self;
}

- (void)finishedWithBoolean:(BOOL)canceled
                     withId:(id)returnValue {
  RAREWindowViewer *w = [RAREPlatform getWindowViewer];
  [((RAREWindowViewer *) nil_chk(w)) hideWaitCursor];
  if (!canceled) {
    if ([returnValue isKindOfClass:[JavaLangThrowable class]]) {
      [CCPBVUtils handleErrorWithJavaLangThrowable:(JavaLangThrowable *) check_class_cast(returnValue, [JavaLangThrowable class])];
    }
    else {
      RAREUTObjectHolder *oh = (RAREUTObjectHolder *) check_class_cast(returnValue, [RAREUTObjectHolder class]);
      CCPBVDocument_DocumentItem *ditem = (CCPBVDocument_DocumentItem *) check_class_cast(((RAREUTObjectHolder *) nil_chk(oh))->type_, [CCPBVDocument_DocumentItem class]);
      CCPBVaAttachmentHandler *handler = (CCPBVaAttachmentHandler *) check_class_cast(oh->source_, [CCPBVaAttachmentHandler class]);
      id<RAREiViewer> v = (id<RAREiViewer>) check_protocol_cast(oh->value_, @protocol(RAREiViewer));
      RAREGridPaneViewer *gp = gridPane_;
      if ([((RAREGridPaneViewer *) nil_chk(gp)) isDisposed]) {
        [((id<RAREiViewer>) nil_chk(v)) dispose];
        return;
      }
      (void) [gp setViewerWithInt:1 withRAREiViewer:v];
      RAREToolBarViewer *tb = (RAREToolBarViewer *) check_class_cast([gp getWidgetWithNSString:@"genericToolbar"], [RAREToolBarViewer class]);
      if (tb != nil) {
        id<RAREiWidget> field = [tb getWidgetWithNSString:@"genericLabel"];
        if (field != nil) {
          NSString *s = [((CCPBVDocument_DocumentItem *) nil_chk(ditem)) getTitle];
          NSString *date = [ditem getDateString];
          if (date != nil) {
            s = [NSString stringWithFormat:@"%@ - %@", s, date];
          }
          [field setValueWithId:s];
        }
        id<JavaUtilList> buttons = [((CCPBVaAttachmentHandler *) nil_chk(handler)) getToolbarWidgetsWithRAREiViewer:v];
        if (buttons != nil) {
          [tb addSeparator];
          for (id<RAREiWidget> __strong b in buttons) {
            [tb addWidgetWithRAREiWidget:b];
          }
        }
      }
    }
  }
}

- (void)copyAllFieldsTo:(CCPBVDocument_AttachmentCallback *)other {
  [super copyAllFieldsTo:other];
  other->gridPane_ = gridPane_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "initWithRAREGridPaneViewer:", NULL, NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "gridPane_", NULL, 0x0, "LRAREGridPaneViewer" },
  };
  static J2ObjcClassInfo _CCPBVDocument_AttachmentCallback = { "AttachmentCallback", "com.sparseware.bellavista", "Document", 0x8, 1, methods, 1, fields, 0, NULL};
  return &_CCPBVDocument_AttachmentCallback;
}

@end
@implementation CCPBVDocument_$1

- (void)finishedWithBoolean:(BOOL)canceled
                     withId:(id)returnValue {
  @try {
    RAREUTObjectHolder *h = (RAREUTObjectHolder *) check_class_cast(returnValue, [RAREUTObjectHolder class]);
    JavaUtilHashMap *resultsMap = (JavaUtilHashMap *) check_class_cast(((RAREUTObjectHolder *) nil_chk(h))->value_, [JavaUtilHashMap class]);
    RAREFunctionCallbackWaiter_CallbackResult *vr = [((JavaUtilHashMap *) nil_chk(resultsMap)) getWithId:[CCPBVDocument VIEWER_CALLBACK_ID]];
    RAREFunctionCallbackWaiter_CallbackResult *dr = [resultsMap getWithId:[CCPBVDocument DOCUMENT_CALLBACK_ID]];
    if ([((RAREFunctionCallbackWaiter_CallbackResult *) nil_chk(vr)) resultIsError]) {
      [CCPBVUtils handleErrorWithJavaLangThrowable:(JavaLangThrowable *) check_class_cast([vr getReturnValue], [JavaLangThrowable class])];
      return;
    }
    if ([((RAREFunctionCallbackWaiter_CallbackResult *) nil_chk(dr)) resultIsError]) {
      [CCPBVUtils handleErrorWithJavaLangThrowable:(JavaLangThrowable *) check_class_cast([dr getReturnValue], [JavaLangThrowable class])];
      return;
    }
    id<RAREiContainer> v = (id<RAREiContainer>) check_protocol_cast([vr getContent], @protocol(RAREiContainer));
    [this$0_ populateViewerWithRAREiContainer:v];
    NSString *target = [((RAREActionLink *) nil_chk(val$viewerLink_)) getTargetName];
    if (target == nil) {
      target = [RAREiTarget TARGET_WORKSPACE];
    }
    if ([((NSString *) nil_chk([RAREiTarget TARGET_WORKSPACE])) isEqual:target]) {
      [CCPBVUtils pushWorkspaceViewerWithRAREiViewer:v];
    }
    else {
      [((RAREWindowViewer *) nil_chk(val$w_)) activateViewerWithRAREiViewer:v withNSString:target];
    }
  }
  @finally {
    [((RAREWindowViewer *) nil_chk(val$w_)) hideWaitCursor];
  }
}

- (id)initWithCCPBVDocument:(CCPBVDocument *)outer$
         withRAREActionLink:(RAREActionLink *)capture$0
       withRAREWindowViewer:(RAREWindowViewer *)capture$1 {
  this$0_ = outer$;
  val$viewerLink_ = capture$0;
  val$w_ = capture$1;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "LCCPBVDocument" },
    { "val$viewerLink_", NULL, 0x1012, "LRAREActionLink" },
    { "val$w_", NULL, 0x1012, "LRAREWindowViewer" },
  };
  static J2ObjcClassInfo _CCPBVDocument_$1 = { "$1", "com.sparseware.bellavista", "Document", 0x8000, 0, NULL, 3, fields, 0, NULL};
  return &_CCPBVDocument_$1;
}

@end
@implementation CCPBVDocument_$2

- (void)finishedWithBoolean:(BOOL)canceled
                     withId:(id)returnValue {
  [((RAREWindowViewer *) nil_chk(val$w_)) hideWaitCursor];
  if ([returnValue isKindOfClass:[JavaLangException class]]) {
    [CCPBVUtils handleErrorWithJavaLangThrowable:(JavaLangThrowable *) check_class_cast(returnValue, [JavaLangThrowable class])];
  }
  else {
    [this$0_ populateViewerWithRAREiContainer:val$fv_];
  }
}

- (id)initWithCCPBVDocument:(CCPBVDocument *)outer$
       withRAREWindowViewer:(RAREWindowViewer *)capture$0
         withRAREiContainer:(id<RAREiContainer>)capture$1 {
  this$0_ = outer$;
  val$w_ = capture$0;
  val$fv_ = capture$1;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "LCCPBVDocument" },
    { "val$w_", NULL, 0x1012, "LRAREWindowViewer" },
    { "val$fv_", NULL, 0x1012, "LRAREiContainer" },
  };
  static J2ObjcClassInfo _CCPBVDocument_$2 = { "$2", "com.sparseware.bellavista", "Document", 0x8000, 0, NULL, 3, fields, 0, NULL};
  return &_CCPBVDocument_$2;
}

@end
@implementation CCPBVDocument_$3

- (void)viewResizedWithRAREChangeEvent:(RAREChangeEvent *)e {
  if (![((RAREWebBrowser *) nil_chk(val$browser_)) isDisposed] && ([val$browser_ getWidth] > 50)) {
    [((id<RAREiPlatformComponent>) nil_chk([val$browser_ getContainerComponent])) removeViewListenerWithRAREiViewListener:self];
    [val$browser_ setHTMLWithNSString:val$url_ withNSString:val$data_];
  }
}

- (BOOL)wantsResizeEvent {
  return YES;
}

- (id)initWithRAREWebBrowser:(RAREWebBrowser *)capture$0
                withNSString:(NSString *)capture$1
                withNSString:(NSString *)capture$2 {
  val$browser_ = capture$0;
  val$url_ = capture$1;
  val$data_ = capture$2;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "wantsResizeEvent", NULL, "Z", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "val$browser_", NULL, 0x1012, "LRAREWebBrowser" },
    { "val$url_", NULL, 0x1012, "LNSString" },
    { "val$data_", NULL, 0x1012, "LNSString" },
  };
  static J2ObjcClassInfo _CCPBVDocument_$3 = { "$3", "com.sparseware.bellavista", "Document", 0x8000, 1, methods, 3, fields, 0, NULL};
  return &_CCPBVDocument_$3;
}

@end
