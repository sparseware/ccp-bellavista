//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: com/sparseware/bellavista/TrendPanel.java
//
//  Created by decoteaud on 2/17/16.
//

#include "IOSClass.h"
#include "IOSFloatArray.h"
#include "IOSObjectArray.h"
#include "com/appnativa/rare/Platform.h"
#include "com/appnativa/rare/scripting/Functions.h"
#include "com/appnativa/rare/spot/Label.h"
#include "com/appnativa/rare/ui/ColorUtils.h"
#include "com/appnativa/rare/ui/Column.h"
#include "com/appnativa/rare/ui/FontUtils.h"
#include "com/appnativa/rare/ui/RenderableDataItem.h"
#include "com/appnativa/rare/ui/ScreenUtils.h"
#include "com/appnativa/rare/ui/UIColor.h"
#include "com/appnativa/rare/ui/UIDimension.h"
#include "com/appnativa/rare/ui/UIFont.h"
#include "com/appnativa/rare/ui/UIFontHelper.h"
#include "com/appnativa/rare/ui/UIProperties.h"
#include "com/appnativa/rare/ui/iPlatformComponent.h"
#include "com/appnativa/rare/ui/iPlatformGraphics.h"
#include "com/appnativa/rare/ui/iPlatformIcon.h"
#include "com/appnativa/rare/ui/painter/PaintBucket.h"
#include "com/appnativa/rare/ui/painter/iPlatformComponentPainter.h"
#include "com/appnativa/rare/viewer/TableViewer.h"
#include "com/appnativa/rare/viewer/WindowViewer.h"
#include "com/appnativa/rare/viewer/iContainer.h"
#include "com/appnativa/rare/viewer/iFormViewer.h"
#include "com/appnativa/rare/widget/LabelWidget.h"
#include "com/appnativa/rare/widget/iWidget.h"
#include "com/appnativa/spot/iSPOTElement.h"
#include "com/appnativa/util/Helper.h"
#include "com/appnativa/util/SNumber.h"
#include "com/appnativa/util/json/JSONArray.h"
#include "com/appnativa/util/json/JSONObject.h"
#include "com/sparseware/bellavista/TrendPanel.h"
#include "com/sparseware/bellavista/Utils.h"
#include "java/lang/Float.h"
#include "java/lang/Math.h"
#include "java/lang/StringBuilder.h"
#include "java/text/SimpleDateFormat.h"
#include "java/util/ArrayList.h"
#include "java/util/Date.h"
#include "java/util/HashMap.h"
#include "java/util/Iterator.h"
#include "java/util/LinkedHashMap.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/Set.h"

@implementation CCPBVTrendPanel

static id<JavaUtilMap> CCPBVTrendPanel_trendMap_;
static RARERenderableDataItem * CCPBVTrendPanel_dateLabel_;
static RARERenderableDataItem * CCPBVTrendPanel_valueLabel_;
static RARERenderableDataItem * CCPBVTrendPanel_trendLabel_;
static RAREUIFont * CCPBVTrendPanel_nameFont_;
static RAREUIFont * CCPBVTrendPanel_timePeriodFont_;
static int CCPBVTrendPanel_timePeriodFontHeight_;

+ (id<JavaUtilMap>)trendMap {
  return CCPBVTrendPanel_trendMap_;
}

+ (void)setTrendMap:(id<JavaUtilMap>)trendMap {
  CCPBVTrendPanel_trendMap_ = trendMap;
}

+ (RARERenderableDataItem *)dateLabel {
  return CCPBVTrendPanel_dateLabel_;
}

+ (void)setDateLabel:(RARERenderableDataItem *)dateLabel {
  CCPBVTrendPanel_dateLabel_ = dateLabel;
}

+ (RARERenderableDataItem *)valueLabel {
  return CCPBVTrendPanel_valueLabel_;
}

+ (void)setValueLabel:(RARERenderableDataItem *)valueLabel {
  CCPBVTrendPanel_valueLabel_ = valueLabel;
}

+ (RARERenderableDataItem *)trendLabel {
  return CCPBVTrendPanel_trendLabel_;
}

+ (void)setTrendLabel:(RARERenderableDataItem *)trendLabel {
  CCPBVTrendPanel_trendLabel_ = trendLabel;
}

+ (RAREUIFont *)nameFont {
  return CCPBVTrendPanel_nameFont_;
}

+ (void)setNameFont:(RAREUIFont *)nameFont {
  CCPBVTrendPanel_nameFont_ = nameFont;
}

+ (RAREUIFont *)timePeriodFont {
  return CCPBVTrendPanel_timePeriodFont_;
}

+ (void)setTimePeriodFont:(RAREUIFont *)timePeriodFont {
  CCPBVTrendPanel_timePeriodFont_ = timePeriodFont;
}

+ (int)timePeriodFontHeight {
  return CCPBVTrendPanel_timePeriodFontHeight_;
}

+ (int *)timePeriodFontHeightRef {
  return &CCPBVTrendPanel_timePeriodFontHeight_;
}

- (id)initWithNSString:(NSString *)name
          withNSString:(NSString *)title
   withRAREUTJSONArray:(RAREUTJSONArray *)keys
           withBoolean:(BOOL)reverseChronologicalOrder {
  if (self = [super init]) {
    self->title_ = title;
    self->name_ = name;
    self->reverseChronologicalOrder_ = reverseChronologicalOrder;
    if (keys != nil) {
      keyMap_ = [((id<JavaUtilMap>) nil_chk(CCPBVTrendPanel_trendMap_)) getWithId:title];
      if (keyMap_ == nil) {
        int len = [keys size];
        id<JavaUtilMap> map = [[JavaUtilLinkedHashMap alloc] initWithInt:len];
        for (int i = 0; i < len; i++) {
          RAREUTJSONObject *o = [keys getJSONObjectWithInt:i];
          NSString *key = [((RAREUTJSONObject *) nil_chk(o)) getStringWithNSString:@"key"];
          (void) [map putWithId:key withId:[o getStringWithNSString:@"name"]];
          NSString *peer = [o optStringWithNSString:@"peer" withNSString:nil];
          if (peer != nil) {
            if (peers_ == nil) {
              peers_ = [[JavaUtilHashMap alloc] initWithInt:2];
            }
            (void) [((id<JavaUtilMap>) nil_chk(peers_)) putWithId:key withId:peer];
          }
        }
        keyMap_ = map;
        (void) [CCPBVTrendPanel_trendMap_ putWithId:title withId:map];
      }
    }
  }
  return self;
}

- (BOOL)addTrendWithNSString:(NSString *)key
            withJavaUtilDate:(JavaUtilDate *)date
  withRARERenderableDataItem:(RARERenderableDataItem *)valueItem {
  NSString *name = [((id<JavaUtilMap>) nil_chk(keyMap_)) getWithId:key];
  if (name == nil) {
    return NO;
  }
  if (trends_ == nil) {
    trends_ = [[JavaUtilLinkedHashMap alloc] init];
  }
  CCPBVTrendPanel_Trend *t = [((id<JavaUtilMap>) nil_chk(trends_)) getWithId:key];
  if (t == nil) {
    t = [[CCPBVTrendPanel_Trend alloc] initWithNSString:name withBoolean:reverseChronologicalOrder_];
    (void) [trends_ putWithId:key withId:t];
  }
  [((CCPBVTrendPanel_Trend *) nil_chk(t)) addWithJavaUtilDate:date withNSString:[((RARERenderableDataItem *) nil_chk(valueItem)) description] withRAREUIColor:[valueItem getForeground]];
  return YES;
}

- (BOOL)addTrendWithNSString:(NSString *)key
            withJavaUtilDate:(JavaUtilDate *)date
                withNSString:(NSString *)name
  withRARERenderableDataItem:(RARERenderableDataItem *)valueItem {
  if (trends_ == nil) {
    trends_ = [[JavaUtilLinkedHashMap alloc] init];
  }
  CCPBVTrendPanel_Trend *t = [((id<JavaUtilMap>) nil_chk(trends_)) getWithId:key];
  if (t == nil) {
    t = [[CCPBVTrendPanel_Trend alloc] initWithNSString:name withBoolean:reverseChronologicalOrder_];
    (void) [trends_ putWithId:key withId:t];
  }
  [((CCPBVTrendPanel_Trend *) nil_chk(t)) addWithJavaUtilDate:date withNSString:[((RARERenderableDataItem *) nil_chk(valueItem)) description] withRAREUIColor:[valueItem getForeground]];
  return YES;
}

- (void)clear {
  if (trends_ != nil) {
    [trends_ clear];
  }
}

- (void)removePeers {
  if ((peers_ != nil) && (trends_ != nil)) {
    id<JavaUtilIterator> it = [((id<JavaUtilSet>) nil_chk([peers_ entrySet])) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
      id<JavaUtilMap_Entry> e = [it next];
      NSString *key = [((id<JavaUtilMap_Entry>) nil_chk(e)) getKey];
      if ([trends_ containsKeyWithId:key]) {
        NSString *peer = [e getValue];
        (void) [trends_ removeWithId:peer];
        (void) [((id<JavaUtilMap>) nil_chk(CCPBVTrendPanel_trendMap_)) removeWithId:peer];
      }
    }
  }
}

- (void)popuplateTableWithRARETableViewer:(RARETableViewer *)table
                          withJavaUtilMap:(id<JavaUtilMap>)layout {
  RAREWindowViewer *w = [RAREPlatform getWindowViewer];
  if (CCPBVTrendPanel_timePeriodFont_ == nil) {
    [CCPBVTrendPanel setupLabelsWithRAREWindowViewer:w];
  }
  int colCount = [((RARETableViewer *) nil_chk(table)) getColumnCount];
  RARELabelWidget *label = [RAREaLabelWidget createWithRAREiContainer:[table getFormViewer] withRARESPOTLabel:(RARESPOTLabel *) check_class_cast([((RAREWindowViewer *) nil_chk(w)) createConfigurationObjectWithNSString:@"Label" withNSString:@"bv.label.trendPanelHeader"], [RARESPOTLabel class])];
  [((RARELabelWidget *) nil_chk(label)) setValueWithId:title_];
  RARERenderableDataItem *header = [table createRowWithInt:colCount withBoolean:YES];
  [((RARERenderableDataItem *) nil_chk(header)) setHeightWithInt:[((RAREUIDimension *) nil_chk([label getPreferredSize])) intHeight]];
  RARERenderableDataItem *item = [header getWithInt:0];
  RARERenderableDataItem *col;
  [((RARERenderableDataItem *) nil_chk(item)) setRenderingComponentWithRAREiPlatformComponent:[label getContainerComponent]];
  [item setColumnSpanWithInt:colCount];
  [table addExWithRARERenderableDataItem:header];
  BOOL singleColumn = [table getColumnCount] == 1;
  if ((trends_ == nil) || [trends_ isEmpty]) {
    header = [table createRowWithInt:colCount withBoolean:YES];
    col = [((RARERenderableDataItem *) nil_chk(header)) getWithInt:0];
    [((RARERenderableDataItem *) nil_chk(col)) setColumnSpanWithInt:colCount];
    item = [[RARERenderableDataItem alloc] initWithId:[w getStringWithNSString:@"bv.text.no_lab_trends"]];
    [item setEnabledWithBoolean:NO];
    [item setHorizontalAlignmentWithRARERenderableDataItem_HorizontalAlignEnum:[RARERenderableDataItem_HorizontalAlignEnum CENTER]];
    (void) [col setCustomPropertyWithId:[((id<JavaUtilMap>) nil_chk(layout)) getWithId:@"name"] withId:item];
    [table addExWithRARERenderableDataItem:header];
    return;
  }
  int count = (int) [JavaLangMath floorWithDouble:([((id<JavaUtilMap>) nil_chk(trends_)) size] + 1) / colCount];
  id<JavaUtilList> list = [[JavaUtilArrayList alloc] initWithInt:count];
  for (int i = 0; i < count; i++) {
    [list addWithId:[table createRowWithInt:colCount withBoolean:YES]];
  }
  id<JavaUtilIterator> it;
  if (keyMap_ == nil) {
    it = [((id<JavaUtilSet>) nil_chk([trends_ keySet])) iterator];
  }
  else {
    it = [((id<JavaUtilSet>) nil_chk([keyMap_ keySet])) iterator];
  }
  RARERenderableDataItem *row = nil;
  int n = 0;
  int i = 0;
  RAREPaintBucket *pb = [((RAREUIProperties *) nil_chk([RAREPlatform getUIDefaults])) getPaintBucketWithNSString:@"TrendPanel.trendName"];
  id<RAREiPlatformComponentPainter> cp = (pb == nil) ? nil : [pb getCachedComponentPainter];
  RAREUIFont *font = CCPBVTrendPanel_nameFont_;
  ;
  if ((pb != nil) && ([pb getFont] != nil)) {
    font = [pb getFont];
  }
  id ctx = [((RAREColumn *) nil_chk([table getColumnWithInt:0])) getValueContext];
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    CCPBVTrendPanel_Trend *t = [trends_ getWithId:[it next]];
    if (t == nil) {
      continue;
    }
    if (n == 0) {
      row = [list getWithInt:i++];
    }
    col = [((RARERenderableDataItem *) nil_chk(row)) getWithInt:n];
    [row setLinkedDataWithId:t];
    item = [[RARERenderableDataItem alloc] initWithId:((CCPBVTrendPanel_Trend *) nil_chk(t))->name_];
    [item setFontWithRAREUIFont:font];
    [item setComponentPainterWithRAREiPlatformComponentPainter:cp];
    (void) [((RARERenderableDataItem *) nil_chk(col)) setCustomPropertyWithId:[((id<JavaUtilMap>) nil_chk(layout)) getWithId:@"name"] withId:item];
    item = [[RARERenderableDataItem alloc] initWithId:t->value_];
    if (IOSObjectArray_Get(nil_chk(t->colors_), 3) != nil) {
      [item setForegroundWithRAREUIColor:IOSObjectArray_Get(t->colors_, 3)];
    }
    (void) [col setCustomPropertyWithId:[layout getWithId:@"valueValue"] withId:item];
    item = [[RARERenderableDataItem alloc] initWithId:t->date_ withInt:RARERenderableDataItem_TYPE_DATETIME withId:nil];
    [item setValueContextWithId:ctx];
    (void) [col setCustomPropertyWithId:[layout getWithId:@"dateValue"] withId:item];
    item = [[RARERenderableDataItem alloc] initWithNSString:@"" withId:nil withRAREiPlatformIcon:t];
    (void) [col setCustomPropertyWithId:[layout getWithId:@"trendIcon"] withId:item];
    (void) [col setCustomPropertyWithId:[layout getWithId:@"date"] withId:CCPBVTrendPanel_dateLabel_];
    (void) [col setCustomPropertyWithId:[layout getWithId:@"value"] withId:CCPBVTrendPanel_valueLabel_];
    if (!singleColumn) {
      n = 1 - n;
    }
  }
  for (i = 0; i < count; i++) {
    row = [list getWithInt:i];
    if ([((RARERenderableDataItem *) nil_chk(row)) getLinkedData] != nil) {
      [row setLinkedDataWithId:nil];
      [table addExWithRARERenderableDataItem:row];
    }
  }
}

- (NSString *)popuplateFormWithRAREiContainer:(id<RAREiContainer>)fv {
  RAREWindowViewer *w = [RAREPlatform getWindowViewer];
  if (CCPBVTrendPanel_timePeriodFont_ == nil) {
    [CCPBVTrendPanel setupLabelsWithRAREWindowViewer:w];
  }
  int count = [JavaLangMath minWithInt:(trends_ == nil) ? 0 : [trends_ size] withInt:[((id<RAREiContainer>) nil_chk(fv)) getWidgetCount]];
  if (count == 0) {
    return nil;
  }
  NSString *format = [((RAREWindowViewer *) nil_chk(w)) getStringWithNSString:@"bv.format.trend"];
  JavaUtilDate *beg = nil;
  JavaUtilDate *end = nil;
  BOOL html = [((NSString *) nil_chk(format)) hasPrefix:@"<html>"];
  id<JavaUtilIterator> it;
  if (keyMap_ == nil) {
    it = [((id<JavaUtilSet>) nil_chk([((id<JavaUtilMap>) nil_chk(trends_)) keySet])) iterator];
  }
  else {
    it = [((id<JavaUtilSet>) nil_chk([keyMap_ keySet])) iterator];
  }
  JavaLangStringBuilder *sb = html ? [[JavaLangStringBuilder alloc] init] : nil;
  NSString *fg;
  NSString *dfg = [((RAREUIColor *) nil_chk([RAREColorUtils getForeground])) toHexString];
  NSString *pfg = html ? [((RAREUIColor *) nil_chk([RAREColorUtils getColorWithNSString:@"clinicalPrompt"])) toHexString] : nil;
  JavaTextSimpleDateFormat *df = [[JavaTextSimpleDateFormat alloc] initWithNSString:[w getStringWithNSString:@"bv.format.time.small_trend_date"]];
  int i = 0;
  while (i < count) {
    CCPBVTrendPanel_Trend *t = [((id<JavaUtilMap>) nil_chk(trends_)) getWithId:[((id<JavaUtilIterator>) nil_chk(it)) next]];
    if (t == nil) {
      continue;
    }
    if (IOSObjectArray_Get(nil_chk(((CCPBVTrendPanel_Trend *) nil_chk(t))->colors_), 3) != nil) {
      fg = [((RAREUIColor *) IOSObjectArray_Get(t->colors_, 3)) toHexString];
    }
    else {
      fg = dfg;
    }
    if (beg == nil) {
      beg = t->startDate_;
      end = t->date_;
    }
    else {
      if ([((JavaUtilDate *) nil_chk(t->date_)) afterWithJavaUtilDate:end]) {
        end = t->date_;
      }
      if ([((JavaUtilDate *) nil_chk(t->startDate_)) beforeWithJavaUtilDate:beg]) {
        beg = t->startDate_;
      }
    }
    NSString *date = [df formatWithJavaUtilDate:t->date_];
    if (html) {
      [sb setLengthWithInt:0];
      (void) [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([sb appendWithNSString:@"<font color=\""])) appendWithNSString:pfg])) appendWithNSString:@"\">"];
      (void) [((JavaLangStringBuilder *) nil_chk([sb appendWithNSString:date])) appendWithNSString:@"</font>"];
      date = [sb description];
    }
    if (html && [t valueNeedsHTMLEncoding]) {
      t->value_ = [RAREFunctions escapeHTMLWithNSString:t->value_ withBoolean:YES withBoolean:NO];
    }
    NSString *text = [RAREFunctions formatWithNSString:format withNSObjectArray:[IOSObjectArray arrayWithObjects:(id[]){ t->name_, fg, t->value_, date } count:4 type:[IOSClass classWithClass:[NSObject class]]]];
    RARELabelWidget *label = (RARELabelWidget *) check_class_cast([fv getWidgetWithInt:i++], [RARELabelWidget class]);
    [((RARELabelWidget *) nil_chk(label)) setValueWithId:text];
    [label setIconWithRAREiPlatformIcon:t];
  }
  NSString *s = [w getStringWithNSString:@"bv.format.time.general_short"];
  df = [[JavaTextSimpleDateFormat alloc] initWithNSString:s];
  if ([((JavaUtilDate *) nil_chk(beg)) isEqual:end]) {
    s = [df formatWithJavaUtilDate:beg];
  }
  else {
    s = [NSString stringWithFormat:@"%@ - %@", [df formatWithJavaUtilDate:beg], [df formatWithJavaUtilDate:end]];
  }
  return s;
}

+ (void)setupLabelsWithRAREWindowViewer:(RAREWindowViewer *)w {
  [((RARERenderableDataItem *) nil_chk(CCPBVTrendPanel_dateLabel_)) setValueWithId:[NSString stringWithFormat:@"%@:", [((RAREWindowViewer *) nil_chk(w)) getStringWithNSString:@"bv.text.date"]]];
  [((RARERenderableDataItem *) nil_chk(CCPBVTrendPanel_valueLabel_)) setValueWithId:[NSString stringWithFormat:@"%@:", [w getStringWithNSString:@"bv.text.value"]]];
  [((RARERenderableDataItem *) nil_chk(CCPBVTrendPanel_trendLabel_)) setValueWithId:[NSString stringWithFormat:@"%@:", [w getStringWithNSString:@"bv.text.trend"]]];
  [CCPBVTrendPanel_dateLabel_ setHorizontalAlignmentWithRARERenderableDataItem_HorizontalAlignEnum:[RARERenderableDataItem_HorizontalAlignEnum RIGHT]];
  [CCPBVTrendPanel_valueLabel_ setHorizontalAlignmentWithRARERenderableDataItem_HorizontalAlignEnum:[RARERenderableDataItem_HorizontalAlignEnum RIGHT]];
  [CCPBVTrendPanel_trendLabel_ setHorizontalAlignmentWithRARERenderableDataItem_HorizontalAlignEnum:[RARERenderableDataItem_HorizontalAlignEnum RIGHT]];
  CCPBVTrendPanel_nameFont_ = [((RAREUIFont *) nil_chk([RAREFontUtils getDefaultFont])) deriveBold];
  CCPBVTrendPanel_timePeriodFont_ = [((RAREUIFont *) nil_chk([RAREFontUtils getDefaultFont])) deriveFontSizeWithFloat:[((RAREUIFont *) nil_chk([RAREFontUtils getDefaultFont])) getSize] - 4];
  CCPBVTrendPanel_timePeriodFontHeight_ = (int) [RAREFontUtils getFontHeightWithRAREUIFont:CCPBVTrendPanel_timePeriodFont_ withBoolean:NO] - [RAREScreenUtils PLATFORM_PIXELS_4];
  RAREUIColor *color = [RAREColorUtils getColorWithNSString:@"clinicalPrompt"];
  [CCPBVTrendPanel_dateLabel_ setForegroundWithRAREUIColor:color];
  [CCPBVTrendPanel_trendLabel_ setForegroundWithRAREUIColor:color];
  [CCPBVTrendPanel_valueLabel_ setForegroundWithRAREUIColor:color];
  RAREUIFont *font = [RAREFontUtils getDefaultFont];
  font = [font deriveFontSizeWithFloat:[((RAREUIFont *) nil_chk(font)) getSize] - 1];
  [CCPBVTrendPanel_dateLabel_ setFontWithRAREUIFont:font];
  [CCPBVTrendPanel_valueLabel_ setFontWithRAREUIFont:font];
  [CCPBVTrendPanel_trendLabel_ setFontWithRAREUIFont:font];
}

+ (void)initialize {
  if (self == [CCPBVTrendPanel class]) {
    CCPBVTrendPanel_trendMap_ = [[JavaUtilLinkedHashMap alloc] initWithInt:4];
    CCPBVTrendPanel_dateLabel_ = [[RARERenderableDataItem alloc] init];
    CCPBVTrendPanel_valueLabel_ = [[RARERenderableDataItem alloc] init];
    CCPBVTrendPanel_trendLabel_ = [[RARERenderableDataItem alloc] init];
  }
}

- (void)copyAllFieldsTo:(CCPBVTrendPanel *)other {
  [super copyAllFieldsTo:other];
  other->keyMap_ = keyMap_;
  other->name_ = name_;
  other->peers_ = peers_;
  other->reverseChronologicalOrder_ = reverseChronologicalOrder_;
  other->title_ = title_;
  other->trends_ = trends_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "addTrendWithNSString:withJavaUtilDate:withRARERenderableDataItem:", NULL, "Z", 0x1, NULL },
    { "addTrendWithNSString:withJavaUtilDate:withNSString:withRARERenderableDataItem:", NULL, "Z", 0x1, NULL },
    { "popuplateFormWithRAREiContainer:", NULL, "LNSString", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "trendMap_", NULL, 0x8, "LJavaUtilMap" },
    { "name_", NULL, 0x0, "LNSString" },
    { "title_", NULL, 0x0, "LNSString" },
    { "keyMap_", NULL, 0x0, "LJavaUtilMap" },
    { "trends_", NULL, 0x0, "LJavaUtilMap" },
    { "peers_", NULL, 0x0, "LJavaUtilMap" },
    { "reverseChronologicalOrder_", NULL, 0x0, "Z" },
    { "dateLabel_", NULL, 0x8, "LRARERenderableDataItem" },
    { "valueLabel_", NULL, 0x8, "LRARERenderableDataItem" },
    { "trendLabel_", NULL, 0x8, "LRARERenderableDataItem" },
    { "nameFont_", NULL, 0x8, "LRAREUIFont" },
    { "timePeriodFont_", NULL, 0x8, "LRAREUIFont" },
    { "timePeriodFontHeight_", NULL, 0x8, "I" },
  };
  static J2ObjcClassInfo _CCPBVTrendPanel = { "TrendPanel", "com.sparseware.bellavista", NULL, 0x1, 3, methods, 13, fields, 0, NULL};
  return &_CCPBVTrendPanel;
}

@end
@implementation CCPBVTrendPanel_Trend

- (id)initWithNSString:(NSString *)name
           withBoolean:(BOOL)reverseChronologicalOrder {
  if (self = [super init]) {
    numbers_ = [IOSFloatArray arrayWithLength:4];
    colors_ = [IOSObjectArray arrayWithLength:4 type:[IOSClass classWithClass:[RAREUIColor class]]];
    index_ = 4;
    segmentLength_ = [RAREScreenUtils PLATFORM_PIXELS_8];
    startingY_ = -1;
    drawTimePeriod_ = YES;
    self->name_ = name;
    self->reverseChronologicalOrder_ = reverseChronologicalOrder;
  }
  return self;
}

- (void)setPeerWithNSString:(NSString *)peer {
  self->peer_ = peer;
}

- (void)addWithJavaUtilDate:(JavaUtilDate *)date
               withNSString:(NSString *)value
            withRAREUIColor:(RAREUIColor *)color {
  if (index_ > 0) {
    if (self->date_ == nil) {
      self->startDate_ = date;
      self->date_ = date;
      self->value_ = value;
    }
    if (reverseChronologicalOrder_) {
      self->startDate_ = date;
    }
    else {
      self->date_ = date;
    }
    (*IOSFloatArray_GetRef(nil_chk(numbers_), --index_)) = [((RAREUTSNumber *) [[RAREUTSNumber alloc] initWithNSString:value withBoolean:NO]) floatValue];
    (void) IOSObjectArray_Set(nil_chk(colors_), index_, color);
  }
}

- (void)calculateStartingYPositionm {
  int total = [self getIconHeight] - (segmentLength_ * 2);
  int max = total;
  int y = total;
  int min = total;
  float lv = JavaLangFloat_NaN;
  for (int i = 0; i < 4; i++) {
    float num = IOSFloatArray_Get(nil_chk(numbers_), i);
    if ([JavaLangFloat isNaNWithFloat:lv]) {
      if (![RAREUTSNumber isEqualWithFloat:lv withFloat:num]) {
        if (num > lv) {
          y -= segmentLength_;
        }
        else {
          y += segmentLength_;
        }
      }
      min = [JavaLangMath minWithInt:y withInt:min];
      max = [JavaLangMath maxWithInt:y withInt:max];
    }
    lv = num;
  }
  int height = max - min;
  startingY_ = max - height - [RAREScreenUtils PLATFORM_PIXELS_4];
}

- (id<RAREiPlatformIcon>)getDisabledVersion {
  return self;
}

- (int)getIconHeight {
  return (segmentLength_ * 6) + (drawTimePeriod_ ? [CCPBVTrendPanel timePeriodFontHeight] : 0);
}

- (int)getIconWidth {
  if (drawTimePeriod_) {
    if (timePeroid_ == nil) {
      [self calculateTimeperiod];
    }
  }
  return (int) [JavaLangMath maxWithFloat:segmentLength_ * 6 withFloat:timePeriodWidth_ + [RAREScreenUtils PLATFORM_PIXELS_4]];
}

- (void)paintWithRAREiPlatformGraphics:(id<RAREiPlatformGraphics>)g
                             withFloat:(float)x
                             withFloat:(float)y
                             withFloat:(float)width
                             withFloat:(float)height {
  if (startingY_ == -1) {
    [self calculateStartingYPositionm];
  }
  int iw = [self getIconWidth];
  int ih = [self getIconHeight];
  y += (height - ih) / 2;
  width = iw;
  height = ih;
  float d1 = [RAREScreenUtils PLATFORM_PIXELS_1];
  float d2 = [RAREScreenUtils PLATFORM_PIXELS_2];
  height -= [RAREScreenUtils PLATFORM_PIXELS_4];
  float sy = startingY_ + y;
  float ny = sy;
  float sx = x + [RAREScreenUtils PLATFORM_PIXELS_4];
  float lv = JavaLangFloat_NaN;
  RAREUIColor *oc = [((id<RAREiPlatformGraphics>) nil_chk(g)) getColor];
  float sw = [g getStrokeWidth];
  [g setStrokeWidthWithFloat:d1];
  BOOL cardStack = [CCPBVUtils isCardStack];
  if (!cardStack) {
    [g setPaintWithRAREiPlatformPaint:[RAREColorUtils getColorWithNSString:@"trendBackground"]];
    [g fillRectWithFloat:x withFloat:y withFloat:width withFloat:height];
  }
  [g setColorWithRAREUIColor:[RAREColorUtils getControlShadow]];
  [g drawRectWithFloat:x withFloat:y withFloat:width withFloat:height];
  if (drawTimePeriod_) {
    if (timePeroid_ == nil) {
      [self calculateTimeperiod];
    }
    [g setFontWithRAREUIFont:[CCPBVTrendPanel timePeriodFont]];
    [g drawStringWithNSString:timePeroid_ withFloat:x + ((width - timePeriodWidth_) / 2) withFloat:y + [RAREScreenUtils PLATFORM_PIXELS_2] withFloat:[CCPBVTrendPanel timePeriodFontHeight]];
  }
  [g setStrokeWidthWithFloat:d2];
  sy += (drawTimePeriod_ ? [CCPBVTrendPanel timePeriodFontHeight] : 0);
  RAREUIColor *c;
  for (int i = 0; i < 4; i++) {
    float num = IOSFloatArray_Get(nil_chk(numbers_), i);
    if (![JavaLangFloat isNaNWithFloat:lv]) {
      if (![RAREUTSNumber isEqualWithFloat:lv withFloat:num]) {
        if (num > lv) {
          ny = sy - segmentLength_;
        }
        else {
          ny = sy + segmentLength_;
        }
      }
    }
    c = IOSObjectArray_Get(nil_chk(colors_), i);
    [g setColorWithRAREUIColor:(c == nil) ? [RAREUIColor GRAY] : c];
    lv = num;
    [g drawLineWithFloat:sx withFloat:sy withFloat:sx + segmentLength_ withFloat:ny];
    [g setColorWithRAREUIColor:cardStack ? [RAREUIColor WHITE] : [RAREUIColor BLACK]];
    [g drawRoundRectWithFloat:sx - d1 withFloat:sy - d1 withFloat:d2 withFloat:d2 withFloat:d2 withFloat:d2];
    sy = ny;
    sx += segmentLength_;
  }
  [g setColorWithRAREUIColor:cardStack ? [RAREUIColor WHITE] : [RAREUIColor BLACK]];
  [g drawRoundRectWithFloat:sx withFloat:sy - d1 withFloat:d2 withFloat:d2 withFloat:d2 withFloat:d2];
  [g setColorWithRAREUIColor:oc];
  [g setStrokeWidthWithFloat:sw];
}

- (BOOL)valueNeedsHTMLEncoding {
  return ([((NSString *) nil_chk(value_)) indexOf:'>'] != -1) || ([value_ indexOf:'<'] != -1);
}

- (void)calculateTimeperiod {
  int days = [JavaLangMath absWithInt:[RAREUTHelper daysBetweenWithJavaUtilDate:startDate_ withJavaUtilDate:date_]];
  if (days < 1) {
    days = 1;
  }
  RAREUTSNumber *num = [[RAREUTSNumber alloc] init];
  NSString *suf;
  if (days > 365) {
    (void) [num setValueWithDouble:(float) (days / 365)];
    (void) [num setScaleWithInt:1];
    suf = @"year";
  }
  else if (days > 29) {
    (void) [num setValueWithDouble:(float) (days / 30)];
    (void) [num setScaleWithInt:1];
    suf = @"month";
  }
  else {
    (void) [num setValueWithInt:days];
    (void) [num setScaleWithInt:1];
    suf = @"day";
  }
  JavaLangStringBuilder *sb = [[JavaLangStringBuilder alloc] init];
  (void) [sb appendWithNSString:suf];
  if ([num gtWithInt:1]) {
    (void) [sb appendWithNSString:@"s"];
  }
  suf = [RAREPlatform getResourceAsStringWithNSString:[NSString stringWithFormat:@"bv.text.time_trend.%@", [sb description]]];
  [sb setLengthWithInt:0];
  (void) [((JavaLangStringBuilder *) nil_chk([sb appendWithId:num])) appendWithNSString:suf];
  timePeroid_ = [sb description];
  timePeriodWidth_ = [RAREUIFontHelper stringWidthWithRAREUIFont:[CCPBVTrendPanel timePeriodFont] withNSString:timePeroid_];
}

- (BOOL)isDrawTimePeriod {
  return drawTimePeriod_;
}

- (void)setDrawTimePeriodWithBoolean:(BOOL)drawTimePeriod {
  self->drawTimePeriod_ = drawTimePeriod;
}

- (void)copyAllFieldsTo:(CCPBVTrendPanel_Trend *)other {
  [super copyAllFieldsTo:other];
  other->colors_ = colors_;
  other->date_ = date_;
  other->drawTimePeriod_ = drawTimePeriod_;
  other->index_ = index_;
  other->name_ = name_;
  other->numbers_ = numbers_;
  other->peer_ = peer_;
  other->reverseChronologicalOrder_ = reverseChronologicalOrder_;
  other->segmentLength_ = segmentLength_;
  other->startDate_ = startDate_;
  other->startingY_ = startingY_;
  other->timePeriodWidth_ = timePeriodWidth_;
  other->timePeroid_ = timePeroid_;
  other->value_ = value_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "setPeerWithNSString:", NULL, "V", 0x0, NULL },
    { "addWithJavaUtilDate:withNSString:withRAREUIColor:", NULL, "V", 0x0, NULL },
    { "calculateStartingYPositionm", NULL, "V", 0x0, NULL },
    { "getDisabledVersion", NULL, "LRAREiPlatformIcon", 0x1, NULL },
    { "valueNeedsHTMLEncoding", NULL, "Z", 0x0, NULL },
    { "calculateTimeperiod", NULL, "V", 0x0, NULL },
    { "isDrawTimePeriod", NULL, "Z", 0x0, NULL },
    { "setDrawTimePeriodWithBoolean:", NULL, "V", 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "numbers_", NULL, 0x0, "LIOSFloatArray" },
    { "colors_", NULL, 0x0, "LIOSObjectArray" },
    { "index_", NULL, 0x0, "I" },
    { "name_", NULL, 0x0, "LNSString" },
    { "date_", NULL, 0x0, "LJavaUtilDate" },
    { "startDate_", NULL, 0x0, "LJavaUtilDate" },
    { "value_", NULL, 0x0, "LNSString" },
    { "segmentLength_", NULL, 0x0, "I" },
    { "startingY_", NULL, 0x0, "I" },
    { "timePeroid_", NULL, 0x0, "LNSString" },
    { "reverseChronologicalOrder_", NULL, 0x0, "Z" },
    { "peer_", NULL, 0x0, "LNSString" },
  };
  static J2ObjcClassInfo _CCPBVTrendPanel_Trend = { "Trend", "com.sparseware.bellavista", "TrendPanel", 0x9, 8, methods, 12, fields, 0, NULL};
  return &_CCPBVTrendPanel_Trend;
}

@end
