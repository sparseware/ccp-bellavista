//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: com/sparseware/bellavista/service/aRemoteService.java
//
//  Created by decoteaud on 2/17/16.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/appnativa/rare/Platform.h"
#include "com/appnativa/util/CharArray.h"
#include "com/appnativa/util/CharScanner.h"
#include "com/appnativa/util/URLEncoder.h"
#include "com/appnativa/util/json/JSONWriter.h"
#include "com/sparseware/bellavista/ActionPath.h"
#include "com/sparseware/bellavista/service/ContentWriter.h"
#include "com/sparseware/bellavista/service/HttpHeaders.h"
#include "com/sparseware/bellavista/service/aRemoteService.h"
#include "com/sparseware/bellavista/service/iHttpConnection.h"
#include "java/io/IOException.h"
#include "java/io/InputStream.h"
#include "java/io/InputStreamReader.h"
#include "java/io/PrintWriter.h"
#include "java/io/Reader.h"
#include "java/io/StringWriter.h"
#include "java/io/Writer.h"
#include "java/lang/Exception.h"
#include "java/lang/StringBuilder.h"
#include "java/net/URL.h"
#include "java/util/HashMap.h"
#include "java/util/List.h"
#include "java/util/Map.h"

@implementation CCPBVaRemoteService

static NSString * CCPBVaRemoteService_HTML_START_ = @"<html>\n<body>\n<pre style=\"font-size:0.8em; font-family: Lucida Console, Monaco, Menlo, Courier New,monospace\">";
static NSString * CCPBVaRemoteService_HTML_END_ = @"</pre>\n</body>\n</html>";

+ (NSString *)HTML_START {
  return CCPBVaRemoteService_HTML_START_;
}

+ (NSString *)HTML_END {
  return CCPBVaRemoteService_HTML_END_;
}

- (id)init {
  return [super init];
}

- (void)dataNotAvailableWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                             withCCPBVActionPath:(CCPBVActionPath *)path
                                     withBoolean:(BOOL)row
                            withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers
                               withNSStringArray:(IOSObjectArray *)columnNames
                                         withInt:(int)column {
  [((CCPBVHttpHeaders *) nil_chk(headers)) setDefaultResponseHeaders];
  NSString *ext = [CCPBVaRemoteService getExtensionWithCCPBVActionPath:path];
  CCPBVContentWriter *w = [((id<CCPBViHttpConnection>) nil_chk(conn)) getContentWriter];
  if ([@"json" isEqual:ext]) {
    [headers mimeJson];
    JavaIoStringWriter *sw = [[JavaIoStringWriter alloc] init];
    RAREUTJSONWriter *jw = [[RAREUTJSONWriter alloc] initWithJavaIoWriter:sw];
    (void) [((RAREUTJSONWriter *) nil_chk([jw object])) keyWithNSString:IOSObjectArray_Get(nil_chk(columnNames), column)];
    (void) [jw object];
    (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"enabled"])) valueWithBoolean:NO];
    (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"selectable"])) valueWithBoolean:NO];
    (void) [((RAREUTJSONWriter *) nil_chk([jw keyWithNSString:@"value"])) valueWithId:[RAREPlatform getResourceAsStringWithNSString:@"bv.text.data_not_available"]];
    (void) [jw endObject];
    (void) [jw endObject];
    [((CCPBVContentWriter *) nil_chk(w)) writeWithNSString:[sw description]];
  }
  else if ([@"html" isEqual:ext]) {
    [headers mimeHtml];
    [((CCPBVContentWriter *) nil_chk(w)) printlnWithNSString:[CCPBVaRemoteService textToHTMLWithNSString:[RAREPlatform getResourceAsStringWithNSString:@"bv.text.data_not_available"]]];
  }
  else if ([@"txt" isEqual:ext]) {
    [headers mimeText];
    [((CCPBVContentWriter *) nil_chk(w)) printlnWithNSString:[RAREPlatform getResourceAsStringWithNSString:@"bv.text.data_not_available"]];
  }
  else {
    if (row) {
      [headers mimeRow];
      JavaLangStringBuilder *sb = [[JavaLangStringBuilder alloc] initWithNSString:@"{enabled: false;font-style: italic}~"];
      int len = (int) [((IOSObjectArray *) nil_chk(columnNames)) count];
      for (int i = 0; i < len; i++) {
        if (i == column) {
          (void) [sb appendWithNSString:[RAREPlatform getResourceAsStringWithNSString:@"bv.text.data_not_available"]];
        }
        (void) [sb appendWithChar:'^'];
      }
      [((CCPBVContentWriter *) nil_chk(w)) printlnWithNSString:[sb description]];
    }
    else {
      [headers mimeList];
      JavaLangStringBuilder *sb = [[JavaLangStringBuilder alloc] initWithNSString:@"{enabled: false;font-style: italic}"];
      (void) [sb appendWithNSString:[RAREPlatform getResourceAsStringWithNSString:@"bv.text.data_not_available"]];
      [((CCPBVContentWriter *) nil_chk(w)) printlnWithNSString:[sb description]];
    }
  }
}

- (id<JavaUtilMap>)getQueryParamsWithJavaIoInputStream:(JavaIoInputStream *)stream {
  id<JavaUtilMap> params = [[JavaUtilHashMap alloc] init];
  JavaIoReader *r = [[JavaIoInputStreamReader alloc] initWithJavaIoInputStream:stream];
  RAREUTCharArray *s = [[RAREUTCharArray alloc] init];
  int c;
  while ((c = [r read]) != -1) {
    if (c == '&') {
      [self parseParamWithJavaUtilMap:params withRAREUTCharArray:s];
      s->_length_ = 0;
    }
    else {
      (void) [s appendWithChar:(unichar) c];
    }
  }
  [self parseParamWithJavaUtilMap:params withRAREUTCharArray:s];
  [((JavaIoInputStream *) nil_chk(stream)) close];
  return params;
}

- (id<JavaUtilMap>)getQueryParamsWithJavaNetURL:(JavaNetURL *)url
                          withJavaIoInputStream:(JavaIoInputStream *)stream {
  if (stream == nil) {
    return [CCPBVaRemoteService getQueryParamsWithJavaNetURL:url];
  }
  return [self getQueryParamsWithJavaIoInputStream:stream];
}

- (void)noDataWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                   withCCPBVActionPath:(CCPBVActionPath *)path
                           withBoolean:(BOOL)row
                  withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
  [((CCPBVHttpHeaders *) nil_chk(headers)) setDefaultResponseHeaders];
  NSString *ext = [CCPBVaRemoteService getExtensionWithCCPBVActionPath:path];
  if ([@"json" isEqual:ext]) {
    [headers mimeJson];
    [((CCPBVContentWriter *) nil_chk([((id<CCPBViHttpConnection>) nil_chk(conn)) getContentWriter])) writeWithNSString:@"{}"];
  }
  else if ([@"html" isEqual:ext]) {
    [headers mimeHtml];
  }
  else if ([@"txt" isEqual:ext]) {
    [headers mimeText];
  }
  else {
    if (row) {
      [headers mimeRow];
    }
    else {
      [headers mimeList];
    }
  }
  (void) [((id<CCPBViHttpConnection>) nil_chk(conn)) getContentWriter];
}

- (void)noDocumentWithCCPBViHttpConnection:(id<CCPBViHttpConnection>)conn
                       withCCPBVActionPath:(CCPBVActionPath *)path
                      withCCPBVHttpHeaders:(CCPBVHttpHeaders *)headers {
  [((CCPBVHttpHeaders *) nil_chk(headers)) setDefaultResponseHeaders];
  CCPBVContentWriter *w = [((id<CCPBViHttpConnection>) nil_chk(conn)) getContentWriter];
  NSString *ext = [CCPBVaRemoteService getExtensionWithCCPBVActionPath:path];
  NSString *text = [RAREPlatform getResourceAsStringWithNSString:@"bv.text.cant_load_document"];
  if ([@"html" isEqual:ext]) {
    [headers mimeHtml];
    [((CCPBVContentWriter *) nil_chk(w)) writeWithNSString:[CCPBVaRemoteService textToHTMLWithNSString:text]];
  }
  else if ([@"txt" isEqual:ext]) {
    [headers mimeText];
    [((CCPBVContentWriter *) nil_chk(w)) writeWithNSString:text];
  }
}

- (NSString *)getDebugOutput {
  if (debugPrintWriter_ != nil) {
    [debugPrintWriter_ flush];
    return [((JavaIoStringWriter *) nil_chk(debugLogger_)) description];
  }
  return nil;
}

- (void)debugLogWithNSString:(NSString *)msg {
  [((JavaIoPrintWriter *) nil_chk([self getDebugWriter])) printlnWithNSString:msg];
}

- (JavaIoPrintWriter *)getDebugWriter {
  if (debugPrintWriter_ == nil) {
    debugLogger_ = [[JavaIoStringWriter alloc] init];
    debugPrintWriter_ = [[JavaIoPrintWriter alloc] initWithJavaIoWriter:debugLogger_];
  }
  return debugPrintWriter_;
}

- (void)ignoreExceptionWithJavaLangException:(JavaLangException *)e {
  [((JavaLangException *) nil_chk(e)) printStackTraceWithJavaIoPrintWriter:[self getDebugWriter]];
}

- (void)parseParamWithJavaUtilMap:(id<JavaUtilMap>)params
              withRAREUTCharArray:(RAREUTCharArray *)param {
  int n = [((RAREUTCharArray *) nil_chk(param)) indexOfWithChar:'='];
  if (n != -1) {
    if (([param indexOfWithChar:'+'] == -1) && ([param indexOfWithChar:'%'] == -1)) {
      (void) [((id<JavaUtilMap>) nil_chk(params)) putWithId:[param substringWithInt:0 withInt:n] withId:[param substringWithInt:n + 1]];
    }
    else {
      (void) [((id<JavaUtilMap>) nil_chk(params)) putWithId:[RAREUTURLEncoder decodeWithNSString:[param substringWithInt:0 withInt:n]] withId:[RAREUTURLEncoder decodeWithNSString:[param substringWithInt:n + 1]]];
    }
  }
  param->_length_ = 0;
}

+ (NSString *)getExtensionWithCCPBVActionPath:(CCPBVActionPath *)path {
  NSString *s = [((CCPBVActionPath *) nil_chk(path)) peek];
  int n = (s == nil) ? -1 : [s lastIndexOf:'.'];
  return (n == -1) ? nil : [((NSString *) nil_chk(s)) substring:n + 1];
}

+ (id<JavaUtilMap>)getQueryParamsWithNSString:(NSString *)queryString {
  id<JavaUtilMap> params = [[JavaUtilHashMap alloc] init];
  NSString *s = queryString;
  if ((s == nil) || ([s sequenceLength] == 0)) {
    return nil;
  }
  RAREUTCharScanner *sc = [[RAREUTCharScanner alloc] initWithNSString:s];
  while ((s = [sc nextTokenWithChar:'&']) != nil) {
    int n = [((NSString *) nil_chk(s)) indexOf:'='];
    if (n != -1) {
      if (([s indexOf:'+'] == -1) && ([s indexOf:'%'] == -1)) {
        (void) [params putWithId:[s substring:0 endIndex:n] withId:[s substring:n + 1]];
      }
      else {
        (void) [params putWithId:[s substring:0 endIndex:n] withId:[RAREUTURLEncoder decodeWithNSString:[s substring:n + 1]]];
      }
    }
  }
  return params;
}

+ (id<JavaUtilMap>)getQueryParamsWithJavaNetURL:(JavaNetURL *)url {
  return [CCPBVaRemoteService getQueryParamsWithNSString:[((JavaNetURL *) nil_chk(url)) getQuery]];
}

+ (NSString *)textToHTMLWithNSString:(NSString *)text {
  if ([((NSString *) nil_chk(text)) hasPrefix:@"</html>"]) {
    return text;
  }
  else if ([text hasPrefix:@"<div>"]) {
    return [NSString stringWithFormat:@"<html>%@</html>", text];
  }
  else {
    return [NSString stringWithFormat:@"<html>\n<body>\n<pre style=\"font-size:0.8em; font-family: Lucida Console, Monaco, Menlo, Courier New,monospace\">%@</pre>\n</body>\n</html>", text];
  }
}

+ (void)toStringWithJavaIoWriter:(JavaIoWriter *)w
                withJavaUtilList:(id<JavaUtilList>)list
                    withNSString:(NSString *)sep {
  int len = [((id<JavaUtilList>) nil_chk(list)) size] - 1;
  for (int i = 0; i < len; i++) {
    [((JavaIoWriter *) nil_chk(w)) writeWithNSString:(NSString *) check_class_cast([list getWithInt:i], [NSString class])];
    [w writeWithNSString:sep];
  }
  [((JavaIoWriter *) nil_chk(w)) writeWithNSString:(NSString *) check_class_cast([list getWithInt:len], [NSString class])];
}

- (void)copyAllFieldsTo:(CCPBVaRemoteService *)other {
  [super copyAllFieldsTo:other];
  other->debugLogger_ = debugLogger_;
  other->debugPrintWriter_ = debugPrintWriter_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "dataNotAvailableWithCCPBViHttpConnection:withCCPBVActionPath:withBoolean:withCCPBVHttpHeaders:withNSStringArray:withInt:", NULL, "V", 0x1, "JavaIoIOException" },
    { "getQueryParamsWithJavaIoInputStream:", NULL, "LJavaUtilMap", 0x1, "JavaIoIOException" },
    { "getQueryParamsWithJavaNetURL:withJavaIoInputStream:", NULL, "LJavaUtilMap", 0x1, "JavaIoIOException" },
    { "noDataWithCCPBViHttpConnection:withCCPBVActionPath:withBoolean:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "noDocumentWithCCPBViHttpConnection:withCCPBVActionPath:withCCPBVHttpHeaders:", NULL, "V", 0x1, "JavaIoIOException" },
    { "getDebugOutput", NULL, "LNSString", 0x1, NULL },
    { "debugLogWithNSString:", NULL, "V", 0x4, NULL },
    { "getDebugWriter", NULL, "LJavaIoPrintWriter", 0x4, NULL },
    { "ignoreExceptionWithJavaLangException:", NULL, "V", 0x4, NULL },
    { "parseParamWithJavaUtilMap:withRAREUTCharArray:", NULL, "V", 0x4, NULL },
    { "getExtensionWithCCPBVActionPath:", NULL, "LNSString", 0x9, NULL },
    { "getQueryParamsWithNSString:", NULL, "LJavaUtilMap", 0x9, NULL },
    { "getQueryParamsWithJavaNetURL:", NULL, "LJavaUtilMap", 0x9, NULL },
    { "textToHTMLWithNSString:", NULL, "LNSString", 0x9, NULL },
    { "toStringWithJavaIoWriter:withJavaUtilList:withNSString:", NULL, "V", 0x9, "JavaIoIOException" },
  };
  static J2ObjcFieldInfo fields[] = {
    { "HTML_START_", NULL, 0x19, "LNSString" },
    { "HTML_END_", NULL, 0x19, "LNSString" },
    { "debugLogger_", NULL, 0x0, "LJavaIoStringWriter" },
    { "debugPrintWriter_", NULL, 0x0, "LJavaIoPrintWriter" },
  };
  static J2ObjcClassInfo _CCPBVaRemoteService = { "aRemoteService", "com.sparseware.bellavista.service", NULL, 0x401, 15, methods, 4, fields, 0, NULL};
  return &_CCPBVaRemoteService;
}

@end
