//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: com/sparseware/bellavista/Alerts.java
//
//  Created by decoteaud on 3/14/16.
//

#include "IOSClass.h"
#include "com/appnativa/rare/Platform.h"
#include "com/appnativa/rare/iDataCollection.h"
#include "com/appnativa/rare/iPlatformAppContext.h"
#include "com/appnativa/rare/net/ActionLink.h"
#include "com/appnativa/rare/ui/UIAction.h"
#include "com/appnativa/rare/ui/UIColor.h"
#include "com/appnativa/rare/ui/UICompoundIcon.h"
#include "com/appnativa/rare/ui/UIFont.h"
#include "com/appnativa/rare/ui/UIScreen.h"
#include "com/appnativa/rare/ui/UITextIcon.h"
#include "com/appnativa/rare/ui/border/UILineBorder.h"
#include "com/appnativa/rare/ui/iPlatformBorder.h"
#include "com/appnativa/rare/ui/iPlatformIcon.h"
#include "com/appnativa/rare/viewer/TableViewer.h"
#include "com/appnativa/rare/viewer/WindowViewer.h"
#include "com/appnativa/rare/viewer/iFormViewer.h"
#include "com/appnativa/rare/widget/iWidget.h"
#include "com/appnativa/util/StringCache.h"
#include "com/sparseware/bellavista/Alerts.h"
#include "com/sparseware/bellavista/Utils.h"
#include "java/util/Collection.h"
#include "java/util/EventObject.h"
#include "java/util/List.h"

@implementation CCPBVAlerts

static int CCPBVAlerts_lastAlertCount_;
static RAREUITextIcon * CCPBVAlerts_alertCountIcon_;
static RAREUICompoundIcon * CCPBVAlerts_compoundIcon1_;
static RAREUICompoundIcon * CCPBVAlerts_compoundIcon2_;

+ (int)lastAlertCount {
  return CCPBVAlerts_lastAlertCount_;
}

+ (int *)lastAlertCountRef {
  return &CCPBVAlerts_lastAlertCount_;
}

+ (RAREUITextIcon *)alertCountIcon {
  return CCPBVAlerts_alertCountIcon_;
}

+ (void)setAlertCountIcon:(RAREUITextIcon *)alertCountIcon {
  CCPBVAlerts_alertCountIcon_ = alertCountIcon;
}

+ (RAREUICompoundIcon *)compoundIcon1 {
  return CCPBVAlerts_compoundIcon1_;
}

+ (void)setCompoundIcon1:(RAREUICompoundIcon *)compoundIcon1 {
  CCPBVAlerts_compoundIcon1_ = compoundIcon1;
}

+ (RAREUICompoundIcon *)compoundIcon2 {
  return CCPBVAlerts_compoundIcon2_;
}

+ (void)setCompoundIcon2:(RAREUICompoundIcon *)compoundIcon2 {
  CCPBVAlerts_compoundIcon2_ = compoundIcon2;
}

+ (id<RAREiPlatformIcon>)getAlertCountIcon {
  int taskCount = 0;
  id<RAREiDataCollection> dc = [((id<RAREiPlatformAppContext>) nil_chk([RAREPlatform getAppContext])) getDataCollectionWithNSString:@"alerts"];
  taskCount += (dc == nil) ? 0 : [dc size];
  if (taskCount == 0) {
    CCPBVAlerts_lastAlertCount_ = 0;
    return nil;
  }
  if ((taskCount == CCPBVAlerts_lastAlertCount_) && (CCPBVAlerts_alertCountIcon_ != nil)) {
    return CCPBVAlerts_alertCountIcon_;
  }
  NSString *value;
  if (taskCount > 9) {
    value = @"9+";
  }
  else {
    value = [RAREUTStringCache valueOfWithInt:taskCount];
  }
  RAREUILineBorder *b;
  if (CCPBVAlerts_alertCountIcon_ == nil) {
    RAREWindowViewer *w = [RAREPlatform getWindowViewer];
    b = [[RAREUILineBorder alloc] initWithRAREUIColor:[RAREUIColor WHITE] withFloat:[RAREUIScreen PLATFORM_PIXELS_2] withFloat:[RAREUIScreen PLATFORM_PIXELS_16]];
    [b setInsetsPaddingWithFloat:[RAREUIScreen PLATFORM_PIXELS_2] withFloat:[RAREUIScreen PLATFORM_PIXELS_2] withFloat:[RAREUIScreen PLATFORM_PIXELS_2] withFloat:[RAREUIScreen PLATFORM_PIXELS_2]];
    RAREUIFont *font = [((RAREWindowViewer *) nil_chk(w)) getFont];
    font = [font deriveFontWithInt:[RAREUIFont BOLD] withFloat:[((RAREUIFont *) nil_chk(font)) getSize] - 4];
    RAREUITextIcon *icon = [[RAREUITextIcon alloc] initWithJavaLangCharSequence:value withRAREUIColor:[RAREUIColor WHITE] withRAREUIFont:font withRAREiPlatformBorder:b];
    [icon setSquareWithBoolean:YES];
    [icon setBackgroundColorWithRAREUIColor:[((RAREUIColor *) nil_chk([RAREUIColor RED])) alphaWithInt:128]];
    CCPBVAlerts_alertCountIcon_ = icon;
  }
  else {
    b = (RAREUILineBorder *) check_class_cast([CCPBVAlerts_alertCountIcon_ getBorder], [RAREUILineBorder class]);
    [CCPBVAlerts_alertCountIcon_ setTextWithJavaLangCharSequence:value];
  }
  CCPBVAlerts_lastAlertCount_ = taskCount;
  [((RAREUITextIcon *) nil_chk(CCPBVAlerts_alertCountIcon_)) setBorderWithRAREiPlatformBorder:nil];
  int w = [CCPBVAlerts_alertCountIcon_ getIconWidth];
  [((RAREUILineBorder *) nil_chk(b)) setCornerArcWithFloat:w];
  [CCPBVAlerts_alertCountIcon_ setBorderWithRAREiPlatformBorder:b];
  return CCPBVAlerts_alertCountIcon_;
}

+ (void)updateAlertsIcon {
  RAREUIAction *a = [((id<RAREiPlatformAppContext>) nil_chk([RAREPlatform getAppContext])) getActionWithNSString:@"bv.action.alerts"];
  if (a == nil) {
    return;
  }
  id<RAREiPlatformIcon> ai = [RAREPlatform getResourceAsIconWithNSString:@"bv.icon.alert"];
  id<RAREiPlatformIcon> icon = [CCPBVAlerts getAlertCountIcon];
  if (icon == nil) {
    icon = ai;
  }
  else {
    if (CCPBVAlerts_compoundIcon1_ == nil) {
      CCPBVAlerts_compoundIcon1_ = [[CCPBVUtils_BadgeCompoundIcon alloc] initWithRAREiPlatformIcon:ai withRAREiPlatformIcon:icon];
      CCPBVAlerts_compoundIcon2_ = [[CCPBVUtils_BadgeCompoundIcon alloc] initWithRAREiPlatformIcon:ai withRAREiPlatformIcon:icon];
    }
    else {
      [CCPBVAlerts_compoundIcon1_ setSecondIconWithRAREiPlatformIcon:icon];
      [((RAREUICompoundIcon *) nil_chk(CCPBVAlerts_compoundIcon2_)) setSecondIconWithRAREiPlatformIcon:icon];
    }
    if ([((RAREUIAction *) nil_chk(a)) getIcon] == CCPBVAlerts_compoundIcon1_) {
      icon = CCPBVAlerts_compoundIcon2_;
    }
    else {
      icon = CCPBVAlerts_compoundIcon2_;
    }
  }
  [((RAREUIAction *) nil_chk(a)) setEnabledWithBoolean:icon != ai];
  [a setIconWithRAREiPlatformIcon:icon];
}

- (void)onUpdateTableWithNSString:(NSString *)eventName
                  withRAREiWidget:(id<RAREiWidget>)widget
          withJavaUtilEventObject:(JavaUtilEventObject *)event {
  id<RAREiDataCollection> dc = [((id<RAREiPlatformAppContext>) nil_chk([RAREPlatform getAppContext])) getDataCollectionWithNSString:@"alerts"];
  RARETableViewer *table = (RARETableViewer *) check_class_cast([((id<RAREiFormViewer>) nil_chk([((id<RAREiWidget>) nil_chk(widget)) getFormViewer])) getWidgetWithNSString:@"alertsTable"], [RARETableViewer class]);
  [((RARETableViewer *) nil_chk(table)) clear];
  [table handleCollectionWithJavaUtilCollection:[((id<RAREiDataCollection>) nil_chk(dc)) getCollectionWithRAREiWidget:table] withInt:0];
}

- (void)dataParsedWithRAREiWidget:(id<RAREiWidget>)widget
                 withJavaUtilList:(id<JavaUtilList>)rows
               withRAREActionLink:(RAREActionLink *)link {
}

- (id)init {
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "getAlertCountIcon", NULL, "LRAREiPlatformIcon", 0x9, NULL },
    { "dataParsedWithRAREiWidget:withJavaUtilList:withRAREActionLink:", NULL, "V", 0x4, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "lastAlertCount_", NULL, 0xa, "I" },
    { "alertCountIcon_", NULL, 0xa, "LRAREUITextIcon" },
    { "compoundIcon1_", NULL, 0xa, "LRAREUICompoundIcon" },
    { "compoundIcon2_", NULL, 0xa, "LRAREUICompoundIcon" },
  };
  static J2ObjcClassInfo _CCPBVAlerts = { "Alerts", "com.sparseware.bellavista", NULL, 0x1, 2, methods, 4, fields, 0, NULL};
  return &_CCPBVAlerts;
}

@end
